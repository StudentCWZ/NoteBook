# 爬虫开发基础
## HTTP 与 HTTPS
1. HTTP(Hyper Text Transfer Protocol，超文本传输协议)是一个客户端和服务器端请求和应答的标准(TCP)。客户端是终端用户，服务器端是网站。
2. 通过使用 Web 浏览器、网络爬虫或者其他工具，客户端发起到服务器上指定窗口(默认端口是80)的 HTTP 请求，这个客户端叫做用户代理(User Agent)。
3. 响应的服务器上存储着资源，比如 HTML 文件和图像，这个服务器为源服务器(Origin Server)，在用户代理和服务器中间可能存在多个中间层，比如代理、网关或者隧道(Tunnels)。
4. 在浏览器的地址栏输入的网站地址叫做 URL (Uniform Resource Locater，统一资源定位符)。
5. HTTP 协议传输的数据都是未加密的，也是明文的数据，因此使用 HTTP 协议传输隐私信息非常不安全。为了保证这些隐私数据能够加密传输，于是网景公司设计了 SSL(Secure Sockets Layer)协议用于对 HTTP 协议传输的数据进行加密，从而诞生了 HTTPS 。
6. HTTPS(Hyper Text Transfer Protocol orer Secure Sokcket Layer，可以理解为 HTTP+SSL/TLS)在传输数据之前需要客户端(浏览器)与服务器(网站)之间进行一次握手，在握手过程中将确立双方加密传输数据的密码信息。
7. HTTPS 的 SSL 中使用了非对称加密、对称加密以及 HASH 算法，握手过程的简单描述如下：
  - 浏览器将自己支持的一套加密规则发送给网站。
  - 网站从中选出一组加密算法与 HASH 算法，并将自己的身份信息以证书的形式发回给浏览器。证书里面包含网站地址、加密公钥以及证书的颁发机构等信息。
  - 获得网站证书之后浏览器要做以下工作：验证证书的合法性(如颁发证书是否合法、证书中包含的网站地址是否与正在访问的地址一致等)，如果证书受信任，浏览器栏就会显示一个小锁头，否则会给出证书不受信任的提示。如果证书受信任或者用户接受了不受信任的证书，浏览器就会生成一串随机数的密码，并用证书中提供的公钥加密。使用约定好的 HASH 计算握手消息，并使用生成的随机数对消息进行加密，最后将之前生成的所有信息发送给网站。
  - 网站接受浏览器发来的数据之后要做以下操作：使用自己的私钥将信息解密并取出密码，使用密码解密浏览器发来的握手信息，并验证 HASH 是否与浏览器发来一致。使用密码加密一段握手消息，发送给浏览器。
  - 如果浏览器解密并计算握手消息的 HASH 与服务器发来的 HASH 一致，此时握手过程结束，之后所有通信数据将使用之前浏览器生成的随机密码，并利用对称加密算法进行加密。
8. 浏览器与网站相互发送加密的握手消息并验证，目的是保证双方都获得一致的密码，并且可以正常地加密、解密数据，为真正数据的传输做一次测试。另外，HTTPS 一般使用的加密与 HASH 算法如下：
  - 非对称加密算法: RSA、DSA/DSS
  - 对称加密算法: AES、RC4、3DES
  - HASH 算法: MD5、SHA1、SHA256
9. 非对称加密算法用于在握手过程中加密生成的密码，对称加密算法用于对真正传输的数据进行加密，而 HASH 算法用于验证数据的完整性。

## 请求头
1. 请求头描述客户端向服务器发送请求时使用的协议类型、所使用的编码以及发送内容的长度等。
2. 客户端(浏览器)通过输入 URL 后确定等于做了一次向服务器的请求动作，在这个请求里面带有请求参数，请求头在网络爬虫中的作用是相当重要的一部分。
3. 检测请求头是常见的反爬虫策略，因为服务器会对请求头做一次检测来判断这次请求是人为的还是非人为的。为了形成一个良好的代码编写规范，无论网站是否做了 Headers 反爬虫机制，最好每次发送请求都添加请求头。
4. 请求头参数如下：
```
(1) Accept: text/html,image/* (浏览器可以接收的文件类型)
(2) Accept-Charset: ISO-8859-1 (浏览器可以接收的编码类型)
(3) Accept-Encoding: gzip,compress (浏览器可以接收的压缩编码类型)
(4) Accept-Language: en-us,zh-zn (浏览器可以接收的语言和国家类型)
(5) Host: 请求的主机地址和端口。
(6) If-Modified-Since: Tue，11 Jul 2000 18:23:51 GMT (某个页面的缓存时间)
(7) Referer: 请求来自于哪个页面的 URL 。
(8) User-Agent: Mozilla/4.0(compatible, MSIE5.5, Windows NT5.0, 浏览器相关信息)
(9) Cookie: 浏览器暂存服务器发送的信息。
(10) Connetion: close(1.0)/Keep-Alive(1.1) (HTTP 请求版本的特点)
(11) Date: Tue,11 Jul 2000 18:23:51 GMT (请求网站的时间)
```
5. 在网络爬虫中，请求头一定要有 User-Agent ，其他的属性可以根据实际需求添加，因为反爬虫通常检测请求头的 Referer 和 User-Agent ，而 Cookies 不能添加到请求头。
  - 例一：完整的请求头
```
Headers = {
  'Accept': 'text/html,application/xhtml+xml,
            application/xml;q=0.9,*/*;q=0.8',
  'Accept-Language': 'zh-CN,zh;q=0.8',
  'Cache-Control': 'max-age=0',
  'User-Agent': 'Mozilla/5.0 (Windows NT 6.3;WOW64;rv:41.0) Gecko/20100101 Firefox/41.0',
  'Connection': 'Keep-alive',
  'Referer': 'https://moive.douban.com'}
```

## Cookies
1. Cookies 也可以称为 Cookie ，指某些网站为了辨认用户身份，进行 Session 跟踪而储存在用户本地终端上的数据。
2. 一个 Cookies 就是存储在用户主机浏览器的文本文件。
3. Cookies 是纯文本形式，它们不包含任何可执行代码。服务器告诉浏览器将这些信息存储，并且每个请求中都将该信息返回到服务器。服务器之后可以利用这些信息来标识用户。
4. 多数需要登录的网站通常会在用户登录后将用户信息写入 Cookies ，只要这个 Cookies 存在并且合法，就可以自由地浏览这个网站的所有站点。
5. 服务器可以利用 Cookies 包含的信息判断在 HTTP 传输的状态。Cookies 最典型的应用是判断注册用户是否已经登录网站和保留用户信息以便简化登录手续。
6. 一般 Cookies 所具有的属性如下：
  - Domain: 域，表示当前 Cookies 属于哪个域或子域下面。
  - Path: 表示 Cookies 的所属路径。
  - Expire Time/Max-Age: 表示 Cookies 的有效期。
  - Secure: 表示该 Cookies 只能用于 HTTPS 传输。
  - Httponly: 表示此 Cookies 必须用于 HTTP 或 HTTPS 传输。
  - HasKeys: 通过该值指示 Cookies 是否含有子键，返回一个 bool 值。
  - Name: 表示 Cookies 的名称。
  - Value: 单个 Cookies 的值。
  - Values: 单个 Cookies 所包含的键值对的集合。
7. Cookies 优点如下：
  - 极高的扩展性和可用性。
  - 通过良好地编程控制保存在 Cookies 中的 Session 对象的大小。
  - 通过加密和安全传输技术减少 Cookies 被破解的可能性。
  - 只在 Cookies 中存放不敏感数据，即使被盗也不会有重大损失。
  - 可控制 Cookies 的生命期，使之不会永远有效。
8. Cookies 的缺点如下：
  - Cookies 数量和长度的限制。每个 domain 最多只能有 20 条 Cookies ，每个 Cookies 长度不能超过 4 KB，否则就会被截掉。
  - 安全性问题。如果 Cookies 被拦截，就有可能被取得所有的 Session 信息。
  - 某些状态下不可保存在客户端。

## HTML
1. HTML 是超文本标记语言，标准通用标记语言下的一个应用。
2. 超文本就是指页面内可以包含图片、链接、甚至音乐、程序等非文字元素。
3. 超文本标记语言的结构包括头部分(Head)和主体部分(Boby)，其中头部分提供关于网页的信息，主体部分提供网页的具体内容。
  - 例一：简单的 HTML 文档
```
<!DOCTYPE html> # 声明为 HTML5 文档
<html> # 元素是 HTML 页面的根元素
<head> # 元素包含了文档的元(meta)数据
<meta charset="utf-8"> # 元素可提供有关页面的元信息(meta-information)，主要是描述和关键词
<title>Python</title> # 元素描述了文档的标题
</head>
<body> # 元素包含了可见的页面内容
<h1>我的第一个标题</h1> # 定义一个标题
<p>我的第一个段落</p> # 元素定义一个段落
</body>
</html>
```
4. 一个完整的网页必定以 `<html></html>` 为开头和结尾，整个 HTML 可以分为两部分：
```
一个完整的网页必定以 <html></html> 为开头和结尾，整个 HTML 可以分为两部分：
(1) <head></head> 主要是对网页描述、图片和 JavaScript 的引用。 <head> 元素包含所有的头部标签元素。在 <head> 元素中可以插入脚本(scripts)、样式文件(CSS)及各种 meta 信息。该区域可添加的元素标签有 <title>、<style>、<meta>、<link>、<script>、<noscript> 和 <base> 。
(2) <body></body> 是网页信息的主要载体。该标签下还可以包含很多类别的标签，不同的标签有不同的作用，每个标签之间可以是相互独立的，也可以是嵌套、层层递进的关系。
```

## JavaScript
1. JavaScript 是一种直译式脚本语言，是一种动态类型、弱类型、基于原型的语言，内置支持类型。
2. JavaScript 的解释器被称为 JavaScript 引擎，为浏览器的一部分，广泛用于客户端的脚本语言，最早是在 HTML 网页上使用的，用来给 HTML 网页增加动态功能。
3. JavaScript 事件的触发过程：
```
(1) HTML 根据表单 <form></form> 标签相应地生成一个表单。
(2) 当用户在表单输入内容后，单击提交按钮，就会触发 <form></form> 表单里所指向的 validatedForm() 方法，执行相应的 JavaScript 代码。
(3) validateForm() 会判断输入的值是否为空。如果输入值为空，就提示输入名字；若输入的值不为空，则提示提交成功。
```

## JSON
1. JSON(JavaScript Object Notation，JavaScipt 对象标记)是一种轻量级的数据交换格式，采用完全独立于编程语言的文本格式来存储和表示数据。
2. 简洁和清晰的层次结构使得 JSON 成为理想的数据交换语言，易于阅读和编写，同时也易于机器的解析和生成，并有效地提升网络传输效率。
3. JSON 格式说明如下：
  - 对象表示为键值对
  - 数据由逗号分隔
  - 花括号保存对象
  - 方括号保存数组
4. 相关案例
  - 例一：JSON 存储数据
```
MyJSON = {
  "name": "Python",
  "address": {"province": "广东", "city": "广州"}
}
```
5. 一个 JSON 里可以嵌套多个 JSON ，也可以嵌套 JSON 数组，都是以键-值的形式表现。在数据结构上，JSON 与 Python 里的字典非常相似。

## Ajax
1. Ajax 不是一种新的编程语言，而是一种用于创建更好、更快以及交互性更强的 Web 应用程序的技术。
2. 使用 JavaScript 向服务器提出请求并处理响应而不阻塞用户，核心对象是 XMLHTTPRequest 。通过这个对象，JavaScript 可在不重载页面的情况下与 Web 服务器交换数据，即在不需要刷新页面的情况下就可以产生局部刷新的效果。
3. Ajax 在浏览器与 Web 服务器之间使用异步数据传输，这样可以使网页从服务器请求少量的信息，而不是整个页面。
4. JavaScript、XML、HTML 与 CSS 在 Ajax 中使用的 Web 标准已被良好定义，并被所有主流浏览器支持，Ajax 应用程序独立于浏览器和平台。
5. 判断网页数据是否使用 Ajax 最简单的方法是：触发事件之后，判断网页是否发生刷新状态。
6. 如果网页没有发生刷新，数据就自动生成，说明数据的加载是通过 Ajax 生成并渲染到网页上的；反之，数据是听过服务器后台生成的。

## 本章小结
1. 本章主要介绍了与编写爬虫程序相关的 Web 前端开发技术。前端开发技术是爬虫开发人员必备技能之一，也是编写爬虫程序的基础。
2. 关于前端开发技术，应该重点掌握以下内容：
  - HTTP 与 HTTPS: 互联网上应用最为广泛的一种网络协议。目前所有网站开发都基于该协议，也是网站的实现原理。
  - 请求头: 基于 HTTP 与 HTTPS 协议实现，其作用是在通信之间实现信息传递。
  - Cookies: 存储在用户主机浏览器中的文本文件，主要让服务器识别各个用户身份信息。
  - HTML: 服务器返回的网页内容，一般由服务器后台生成。
  - JavaScript: 主要实现网页的动态功能及用户交互。
  - JSON: 表示一个 JavaScript 对象的信息，本质是一个特殊的字符串。
  - Ajax: 表示的前端数据加载和渲染技术，其响应内容大部分以 JSON 格式为主。


