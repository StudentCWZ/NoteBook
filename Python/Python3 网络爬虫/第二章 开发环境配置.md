# 开发环境配置
## 前言

1. 编写和运行程序之前，我们必须先把开发环境配置好。只有配置好了环境并且有了更方便的开发工具，我们才能更加高效地用程序实现相应的功能。
2. 然而很多情况下，我们可能在最开始就卡在环境配置上，如果这个过程花费了太多时间，学习的兴趣可能就下降了大半，所以本章专门对本书中所有的环境配置做一下说明。

## Python3 安装
1. 既然要用Python3开发爬虫，那么第一步一定是安装 Python3 。这里会介绍 Windows、Linux 和 Mac 三大平台下的安装过程。
2. 相关链接
```
(1) 官方网站: http://python.org
(2) 下载地址: https://www.python.org/downloads 
(3) 第三方库: https://pypi.python.org/pypi 
(4) 官方文档: https://docs.python.org/3
(5) 中文教程: https://www.runoob.com/python3/python3-tutorial.html
(6) Awesome Python: https://github.com/vinta/awesome-python
(7) Awesome Python 中文版: https://github.com/jobbole/awesome-python-cn
```

### Windows 下的安装
1. 在 Windows 下安装 Python3 的方式有两种：
```
(1) 一种是通过 Anaconda 安装，它提供了 Python 的科学计算环境，里面自带了 Python 以及常用的库。如果选用了这种方式，后面的环境配置方式会更加简便。 
(2) 另一种是直接下载安装包安装，即标准的安装方式。
```

#### Anaconda 安装
1. Anaconda 的官方下载链接为 https://www.continuum.io/downloads ，选择 Python3 版本的安装包下载即可。
2. 如果下载速度过慢，可以选择使用清华大学镜像，下载列表链接为 https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive，使用说明链接为 https://mirrors.tuna.tsinghua.edu.en/help/anaconda/。
3. 下载完成之后，直接双击安装包安装即可。安装完成之后，Python3 的环境就配置好了。

#### 安装包安装
1. 我们推荐直接下载安装包来安装，此时可以直接到官方网站下载 Python3 的安装包: https://www.python.org/downloads／。
2. Python 的最新版本是 3.8.0，其下载链接为 https://www.python.org/downloads/release/python-380/ ，实际的 Python 最新版本以官网为准。
3. 64 位系统可下载 Windowsx86-64 executable installer ，32 系统可以下载 Windowsx86 executable installer 。
4. 下载完成之后，直接双击 Python 安装包，然后通过图形界面安装。接着设置 Python 的安装路径，完成后将 Python3 和 Python3 的 Scripts 目录配置到环境变量即可。
5. 关于环境变量的配置，此处以 Windows10 系统为例进行演示：
```
(1) 假如安装后的 Python3 路径为 C:\Python36 ，从资源管理器中打开该路径，将该路径复制下来。
(2) 随后，右击“计算机”，从中选择“属性”，此时将打开系统属性窗口，点击左侧的“高级系统设置”，即可在弹出的对话框下方看到“环境变量”按钮。
(3) 点击“环境变量”按钮，找到系统变量下的 Path 变量，随后点击“编辑”按钮。
(4) 随后点击“新建”，新建一个条目，将刚才的 C:\Python36 复制进去。这里需要说明的是，此处的路径就是你的 Python3 安装目录，请自行替换。然后，再把 C:\Python36\Scripts 路径复制进去，最后，点击“确定”按钮即可完成环境变量的配置。
(5) 配置好环境变量后我们就可以在命令行中直接执行环境变量路径下的可执行文件了，如 python、pip 等命令。
```

#### 添加别名
1. 上面这两种安装方式任选其一即可完成安装，但如果之前安装过 Python2 的话，可能会导致版本冲突问题，比如在命令行下输入 python 就不知道是调用的 Python2 还是 Python3 了。
2. 为了解决这个问题，建议将安装目录中的 python.exe 复制一份，命名为 python3.exe，这样便可以调用 python3 命令了。实际上，它和 python 命令是完全一致的，这样只是为了可以更好地区分 Python 版本。当然，如果没有安装过 Python2 的话，也建议添加此别名。
3. 对于 pip 来说，安装包中自带了 pip3.exe 可执行文件，我们也可以直接使用 pip3 命令，无需额外配置。

#### 测试验证
1. 安装完成后，可以通过命令行测试一下安装是否成功。在“开始”菜单中搜索 cmd ，找到命令提示符，此时就进入命令行模式了。
2. 输入 python，测试一下能否成功调用 Python 。如果添加了别名的话，可以输入 python3 测试。

### Linux 下的安装
1. Linux 下的安装方式有多种：命令安装、源码安装和 Anaconda 安装。
2. 使用源码安装需要自行编译，时间较长。推荐使用系统自带的命令或 Anaconda 安装，简单、高效。这里分别讲解这 3 种安装方式。

#### 命令行安装
1. 不同的 Linux 发行版本的安装方式又有不同，在此分别予以介绍。

##### CentOS、Red Hat
```
(1) 如果是 CentOS 或 Red Hat 版本，则使用yum命令安装即可。
(2) 下面列出了 Python3.5 和 Python3.4 两个版本的安装方法，可以自行选择。
(3) Python3.5 版本：
sudo yum install -y https://centos7.iuscommunity.org/ius-release.rpm
sudo yum update
sudo yum install -y python35u python35u-libs python35u-devel python35u-pip
(4) Python3.4 版本：
sudo yum groupinstall -y development tools
sudo yum install -y epel-release python34-devel libxslt-devel libxml2-devel openssl-devel
sudo yum install -y python34
sudo yum install -y python34-setuptools
sudo easy_install-3.4 pip
```

##### Ubuntu、Debian 和 Deepin
1. 首先安装 Python3 ，这里使用 apt-get 安装即可。在安装前，还需安装一些基础库，相关命令如下
```
sudo apt-get install -y python3-dev build-essential libssl-dev libffi-dev libxml2 libxml2-dev libxslt1-dev zlib1g-dev libcurl4-openssl-dev
sudo apt-get install -y python3
```
2. 然后还需要安装 pip3 ，这里仍然使用 apt-get 安装即可，相关命令如下：
```
sudo apt-get install -y python3-pip
```

#### 源码安装
1. 如果命令行的安装方式有问题，还可以下载 Python3 源码进行安装。源码下载地址为 https://www.python.org/ftp/python/ ，可以自行选用想要的版本进行安装。
2. 这里以 Python3.8.0 为例进行说明，安装路径设置为 /usr/local/python3 。
```
(1) 首先，创建安装目录，相关命令如下：
sudo mkdir /usr/local/python3
(2) 随后下载安装包并解压进入，相关命令如下：
wget --no-check-certificate https://www.python.org/ftp/python/3.8.0/Python-3.8.0.tgz
tar -xzvf Python-3.8.0.tgz
cd Python-3.8.0
(3) 接下来，编译安装。所需的时间可能较长，请耐心等待，命令如下：
sudo ./configure --prefix=/usr/local/python3
sudo make
sudo make install
(4) 安装完成之后，创建 Python3 软链接，相关命令如下：
sudo ln -s /usr/local/python3/bin/python3 /usr/bin/python3
(5) 随后下载 pip 安装包并安装，命令如下：
wget --no-check-certificate https://github.com/pypa/pip/archive/9.0.1.tar.gz
tar -xzvf 9.0.1.tar.gz
cd pip-9.0.1
python3 setup.py install
(6) 安装完成后再创建 pip3 软链接，相关命令如下：
sudo ln -s /usr/local/python3/bin/pip /usr/bin/pip3
```

#### Anaconda 安装
1. Anaconda 同样支持 Linux ，其官方下载链接为 https://www.continuum.io/downloads ，选择 Python3 版本的安装包下载即可。
2. 如果下载速度过慢，同样可以使用清华镜像，具体可参考 Windows 部分的介绍。

### Mac 下的安装
#### Homebrew 安装
1. 在 Mac 下同样有多种安装方式，如 Homebrew、安装包安装、Anaconda 安装等，这里推荐使用 Homebrew 安装。
2. Homebrew 是 Mac 平台下强大的包管理工具，其官方网站是 https://brew.sh/。
3. 执行如下命令，即可安装 Homebrew:
```
ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
```
4. 安装完成后，便可以使用 brew 命令安装 Python3 和 pip3 了：
```
brew install python3
```

#### 安装包安装
1. 可以到官方网站下载 Python3 安装包，链接为 https://www.python.org/downloads/。
2. 在 Mac 平台下，可以选择下载 Mac OS X 64-bit/32-bit installer ，下载完成后，打开安装包，按照提示安装即可。

#### Anaconda 安装
1. Anaconda 同样支持 Mac ，其官方下载链接为 https://www.continuum.io/downloads，选择 Python3 版本的安装包下载即可。
2. 如果下载速度过慢，同样可以使用清华镜像，具体可参考 Windows 部分的介绍。

## 请求库的安装
1. 爬虫可以简单分为几步：抓取页面、分析页面和存储数据。
2. 在抓取页面的过程中，我们需要模拟浏览器向服务器发出请求，所以需要用到一些 Python 库来实现 HTTP 请求操作。
3. 在本书中，我们用到的第三方库有 requests、selenium 和 aiohttp 等。在本节中，我们介绍一下这些请求库的安装方法。

### requests 安装
1. 由于 requests 属于第三方库，也就是 Python 默认不会自带这个库，所以需要我们手动安装。我们首先看一下它的安装过程。
2. 相关链接
```
(1) GitHub: https://github.com/requests/requests
(2) PyPI: https://pypi.python.org/pypi/requests
(3) 官方文档: http://www.python-requests.org
(4) 中文文档: http://docs.python-requests.org/zh_CN/latest
```

#### pip 安装
1. 无论是 Windows、Linux 还是 Mac，都可以通过 pip 这个包管理工具来安装。在命令行界面中运行如下命令，即可完成 requests 库的安装：
```
pip3 install requests
```

#### wheel 安装
1. wheel 是 Python 的一种安装包，其后缀为 .whl ，在网速较差的情况下可以选择下载 wheel 文件再安装，然后直接用 pip3 命令加文件名安装即可。
2. 不过在这之前，需要先安装 wheel 库，安装命令如下：
```
pip3 install wheel
```
3. 然后到 PyPI 上下载对应的 wheel 文件，如最新版本为 2.17.3 ，则打开 https://pypi.python.org/pypi/requests/2.17.3#downloads ， 下载 requests-2.17.3-py2.py3-none-any.whl 到本地。
4. 随后在命令行界面进入 wheel 文件目录，利用 pip 安装即可：
```
pip3 install requests-2.17.3-py2.py3-none-any.whl
```

#### 源码安装
1. 如果你不想用 pip 来安装，或者想获取某一特定版本，可以选择下载源码安装。此种方式需要先找到此库的源码地址，然后下载下来再用命令安装。
2. requests 项目的地址是：https://github.com/kennethreitz/requests 。
3. 可以通过 Git 来下载源代码：
```
git clone git://github.com/kennethreitz/requests.git
```
4. 通过 curl 下载：
```
curl -OL https://github.com/kennethreitz/requests/tarball/master
```
5. 下载之后，进入目录，执行如下命令即可安装：
```
cd requests 
python3 setup.py install
```

### selenium 的安装
1. selenium 是一个自动化测试工具，利用它我们可以驱动浏览器执行特定的动作，如点击、下拉等操作。对于一些 JavaScript 渲染的页面来说，这种抓取方式非常有效。
2. 相关链接
```
(1) 官方网站：http://www.seleniumhq.org
(2) GitHub: https://github.com/SeleniumHQ/selenium/tree/master/py
(3) PyPI: https://pypi.python.org/pypi/selenium
(4) 官方文档: http://selenium-python.readthedocs.io
(5) 中文文档: http://selenium-python-zh.readthedocs.io
```

#### pip 安装
1. 这里推荐直接使用 pip 安装，执行如下命令即可：
```
pip3 install selenium
```

#### wheel 安装
1. 此外，也可以到 PyPI 下载对应的 wheel 文件进行安装(下载地址：https://pypi.python.org/pypi/selenium/#downloads)，如最新版本为 3.4.3 ，则下载 selenium-3.4.3-py2.py3-none-any.whl 即可。
2. 然后进入 wheel 文件目录，使用 pip 安装：
```
pip3 install selenium-3.4.3-py2.py3-none-any.whl
```
3. 验证安装：进入 Python 命令行交互模式，导入 selenium 包，如果没有报错，则证明安装成功。

#### ChromeDrive 的安装
1. 我们成功安装好了 selenium 库，但是它是一个自动化测试工具，需要浏览器配合使用，本节中我们就介绍一下 Chrome 浏览器及 ChromeDriver 驱动的配置。
2. 首先，下载 Chrome 浏览器，随后安装 ChromeDriver 。因为只有安装 ChromeDriver ，才能驱动 Chrome 浏览器完成相应的操作。
3. 相关链接
```
(1) 官方网站: https://sites.google.com/a/chromium.org/chromedriver
(2) 下载地址: https://chromedriver.storage.googleapis.com/index.btml
```

##### 准备工作
1. 在这之前请确保已经正确安装好了 Chrome 浏览器并可以正常运行，安装过程不再赘述。

##### 查看版本
1. 点击 Chrome 菜单 “帮助” → “关于 Google Chrome ”，即可查看 Chrome 的版本号。
2. 下载 ChromeDriver 。打开 ChromeDriver 的官方网站，找好对应的版本号后，随后到 ChromeDriver 镜像站下载对应的安装包即可：https://chromedriver.storage.googleapis.com/index.html 。
3. 在不同平台下，可以下载不同的安装包。

##### 环境变量配置
1. 下载完成后，将 ChromeDriver 的可执行文件配置到环境变量下。在 Windows 下，建议直接将 chromedriver.exe 文件拖到 Python 的 Scripts 目录下。
2. 在 Linux 和 Mac 下，需要将可执行文件配置到环境变量或将文件移动到属于环境变量的目录里。
3. 首先，需要在命令行下进入其所在路径，然后将其移动到 /usr/bin :
```
sudo mv chromedriver /usr/bin
```
4. 当然，也可以将 ChromeDriver 配置到 $PATH 。
5. 首先，可以将可执行文件放到某一目录，目录可以任意选择，例如将当前可执行文件放在 /usr/local/chromedriver 目录下，接下来可以修改 ～/.profile 文件，相关命令如下：
```
export PATH ="$PATH:/usr/local/chromedriver"
```
6. 保存后执行如下命令：
```
source ~/.profile
```

#### GeckoDriver 安装
1. 上一节中，我们了解了 ChromeDriver 的配置方法，配置完成之后便可以用 selenium 驱动 Chrome 浏览器来做相应网页的抓取。
2. 那么对于 Firefox 来说，也可以使用同样的方式完成 selenium 的对接，这时需要安装另一个驱动 GeckoDriver 。
3. 相关链接
```
(1) GitHub: https://github.com/mozilla/geckodriver
(2) 下载地址: https://github.com/mozilla/geckodriver/releases
```

##### 准备工作
1. 在这之前请确保已经正确安装好了 Firefox 浏览器并可以正常运行。

##### 下载 GeckoDriver
1. 我们可以在 GitHub 上找到 GeckoDriver 的发行版本，这里可以在不同的平台上下载，如 Windows、Mac、Linux、ARM 等平台，我们可以根据自己的系统和位数选择对应的驱动下载。
2. 若是 Windows 64位，就下载 geckodriver-v0.18.0-win64.zip 。

##### 环境变量配置
1. 在 Windows 下，可以直接将 geckodriver.exe 文件拖到 Python 的 Scripts 目录下。
2. 在 Linux 和 Mac 下，需要将可执行文件配置到环境变量或将文件移动到属于环境变量的目录里。首先在命令行模式下进入其所在路径，然后将其移动到 /usr/bin :
```
sudo mv geckodriver /usr/bin
```
3. 当然，也可以将 GeckoDriver 配置到 $PATH 。首先，可以将可执行文件放到某一目录，目录可以任意选择，例如将当前可执行文件放在 /usr/local/geckodriver 目录下。
4. 接下来可以修改 ～/.profile 文件，命令如下：
```
vi ~/.profile
```
5. 然后添加配置：
```
export PATH="$PATH:/usr/local/geckodriver"
```
6. 保存后执行如下命令即可完成配置：
```
source ~/.profile
```

#### PhantomJS 安装
1. PhantomJS 是一个无界面的、可脚本编程的 WebKit 浏览器引擎，它原生支持多种 Web 标准：DOM 操作、CSS 选择器、JSON、Canvas 以及 SVG 。
2. selenium 支持 PhantomJS，这样在运行的时候就不会再弹出一个浏览器了。而且 PhantomJS 的运行效率也很高，还支持各种参数配置，使用非常方便。下面我们就来了解一下 PhantomJS 的安装过程。
3. 相关链接
```
(1) 官方网站: http://phantomjs.org
(2) 官方文档: http://phantomjs.org/quick-start.html 
(3) 下载地址: http://phantomjs.org/download.html 
(4) API接口说明: http://phantomjs.org/api/command-line.html
```

##### 下载 PhantomJS
1. 我们需要在官方网站下载对应的安装包，PhantomJS 支持多种操作系统，Mac、FreeBSD 等，我们可以选择对应的平台并将安装包下载下来。
2. 下载完成后，将 PhantomJS 可执行文件所在的路径配置到环境变量里。
3. 比如在 Windows 下，将下载的文件解压之后并打开，会看到一个 bin 文件夹，里面包括一个可执行文件 phantomjs.exe ，我们需要将它直接放在配置好环境变量的路径下或者将它所在的路径配置到环境变量里。
比如，我们既可以将它直接复制到 Python 的 Scripts 文件夹，也可以将它所在的 bin 目录加入到环境变量。

##### 验证安装
1. 在 selenium 中使用的话，我们只需要将 Chrome 切换为 PhantomJS 即可：
```
#!/usr/bin/python3
# -*- coding: utf-8 -*-
'''
# @Author: StudentCWZ
# @Date:   2019-12-16 21:38:58
# @Last Modified by:   StudentCWZ
# @Last Modified time: 2019-12-17 09:14:19
'''


from selenium import webdriver 
browser = webdriver.PhantomJS()
browser.get ('https://www.baidu.com') 
print(browser.current_url)
```
2. 运行之后，我们就不会发现有浏览器弹出了，但实际上 PhantomJS 已经运行起来了，这里我们访问了百度，然后将当前的 URL 打印出来。
3. 控制台的输出如下：
```
https://www.baidu.com/
```
4. 如此一来，我们便完成了 PhantomJS 的配置，后面可以利用它来完成一些页面的抓取。

### aiohttp 安装
1. 之前介绍的 requests 库是一个阻塞式 HTTP 请求库，当我们发出一个请求后，程序会一直等待服务器响应，直到得到响应后，程序才会进行下一步处理。其实，这个过程比较耗费时间。
2. 如果程序可以在这个等待过程中做一些其他的事情，如进行请求的调度、响应的处理等，那么爬取效率一定会大大提高。
3. aiohttp 就是这样一个提供异步 Web 服务的库，从 Python3.5 版本开始，Python 中加入了 async/await 关键字，使得回调的写法更加直观和人性化。
4. aiohttp 的异步操作借助于 async/await 关键字的写法变得更加简洁，架构更加清晰。使用异步请求库进行数据抓取时，会大大提高效率，下面我们来看一下这个库的安装方法。
5. 相关链接
```
(1) 官方文档: http://aiohttp.readthedocs.io/en/stable
(2) GitHub: https://github.com/aio-libs/aiohttp 
(3) PyPI: https://pypi.python.org/pypi/aiohttp
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install aiohttp
```
2. 另外，官方还推荐安装如下两个库：一个是字符编码检测库 cchardet ，另一个是加速 DNS 的解析库 aiodns 。安装命令如下：
```
pip3 install cchardet aiodns
```

#### 测试安装
1. 安装完成之后，可以在 Python 命令行下测试：
```
$ python3
>> import aiohttp
```
2. 如果没有错误报出，则证明库已经安装好了。

## 解析库的安装
1. 抓取网页代码之后，下一步就是从网页中提取信息。提取信息的方式有多种多样，可以使用正则来提取，但是写起来相对比较烦琐。这里还有许多强大的解析库，如 lxml、BeautifulSoup、pyquery 等。
2. 此外，还提供了非常强大的解析方法，如 XPath 解析和 CSS 选择器解析等，利用它们，我们可以高效便捷地从页面中提取有效信息。本节中，我们就来介绍一下这些库的安装过程。

### lxml 安装
1. lxml 是 Python 的一个解析库，支持 HTML 和 XML 的解析，支持 XPath 解析方式，而且解析效率非常高。本节中，我们了解一下 lxml 的安装方式，这主要从 Windows、Linux 和 Mac 三大平台来介绍。
2. 相关链接
```
(1) 官方网站: http://lxml.de 
(2) GitHub: https://github.com/lxml/lxml
(3) PyPI: https://pypi.python.org/pypi/lxml
```

#### Windows 下安装
1. 在 Windows 下，可以先尝试利用 pip 安装，此时直接执行如下命令即可：
```
pip3 install lxml
```
2. 如果没有任何报错，则证明安装成功。
3. 如果出现报错，比如提示缺少 libxml2 库等信息，可以采用 wheel 方式安装。
4. 推荐直接到 http://www.lfd.uci.edu/~goblke/pythonlibs/#lxml 下载对应的 wheel 文件，找到本地安装 Python 版本和系统对应的 lxml 版本。
5. 例如 Windows64 位、Python3.6，就选择 lxml-3.8.0-cp36-cp36m-win_amd64.whl ，将其下载到本地。
6. 然后利用 pip 安装即可，命令如下：
```
pip3 install lxml 3.8.0-cp36-cp36m-win_amd64.whl
```

#### Linux 下的安装
1. 在 Linux 平台下安装问题不大，同样可以先尝试 pip 安装，命令如下：
```
pip3 install lxml
```
2. 如果报错，可以尝试下面的解决方案。
- CentOS、Red Hat
```
(1) 对于此类系统，报错主要是因为缺少必要的库。执行如下命令安装所需的库即可：
Sudo yum groupinstall -y development tools
sudo yum install -y epel-release libxslt-devel libxml2-devel openssl-devel
```
- Ubuntu、Debian 和 Deepin
```
(1) 在这些系统下，报错的原因同样可能是缺少了必要的类库，执行如下命令安装：
sudo apt-get install -y python3-dev build-essential libssl-dev libffi-dev libxml2 libxml2-dev libxslt1-dev zlib1g-dev
```

#### Mac 下的安装
1. 在 Mac 平台下，仍然可以首先尝试 pip 安装，命令如下：
```
pip3 install lxml
```
2. 如果产生错误，可以执行如下命令将必要的类库安装：
```
xcode-select --install
```
3. lxml 是一个非常重要的库，后面的 BeautifulSoup、Scrapy 框架都需要用到此库，所以请一定安装成功。

#### 验证安装
1. 安装完成之后，可以在 Python 命令行下测试：
```
$ python
>>> import lxml
```
2. 如果没有错误报出，则证明库已经安装好了。

### BeautifulSoup 的安装
1. BeautifulSoup 是 Python 的一个 HTML 或 XML 的解析库，我们可以用它来方便地从网页中提取数据。
2. BeautifulSoup 它拥有强大的 API 和多样的解析方式，本节就来了解下它的安装方式。
3. 相关链接
```
(1) 官方文档: https://www.crummy.com/software/BeautifulSoup/bs4/doc
(2) 中文文档: https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh
(3) PyPI: https://pypi.python.org/pypi/beautifulsoup4
```

#### 准备工作
1. BeautifulSoup 的 HTML 和 XML 解析器是依赖于 lxml 库的，所以在此之前请确保已经成功安装好了 lxml 库，具体的安装方式参见上节。

#### pip 安装
1. 目前，BeautifulSoup 的最新版本是 4.x 版本，之前的版本已经停止开发了。
2. 这里推荐使用 pip 来安装，安装命令如下：
```
pip3 install beautifulsoup4
```

#### wheel 安装
1. 当然，我们也可以从 PyPI 下载 wheel 文件安装，链接如下：https://pypi.python.org/pypi/beautifulsoup4 ，然后使用 pip 安装 wheel 文件即可。

#### 验证安装
1. 安装完成之后，可以运行下面的代码验证一下：
```
from bs4 import BeautifulSoup 
soup = BeautifulSoup('<p>Hello</p>', 'lxml') 
print(soup.p.string)
```
2. 运行结果如下：
```
Hello
```
3. 如果运行结果一致，则证明安装成功。

### pyquery 安装
1. pyquery 同样是一个强大的网页解析工具，它提供了和 jQuery 类似的语法来解析 HTML 文档，支持 CSS 选择器，使用非常方便。本节中，我们就来了解一下它的安装方式。
2. 相关链接
```
(1) GitHub: https://github.com/gawel/pyquery 
(2) PyPI: https://pypi.python.org/pypi/pyquery 
(3) 官方文档: https://pyquery.readthedocs.io
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install pyquery
```

#### wheel 安装
1. 当然，我们也可以到 [PyPI](!https://pypi.python.org/pypi/pyquery/#downloads) 下载对应的wheel文件安装。
2. 比如如果当前版本为 1.2.17 ，则下载的文件名称为 pyquery-1.2.17-py2.py3-none-any.whl ，此时下载到本地再进行 pip 安装即可，命令如下：
```
pip3 install pyquery-1.2.17-py2.py3-none-any.whl
```

#### 验证安装
1. 安装完成之后，可以在 Python 命令行下测试：
```
$ python3 
>>> import pyquery
```
2. 如果没有错误报出，则证明库已经安装好了。

### tesserocr 安装
1. 在爬虫过程中，难免会遇到各种各样的验证码，以直接用 OCR 来识别。
2. OCR，即 Optical Character Recognition ，光学字符识别，是指通过扫描字符，然后通过其形状将其翻译成电子文本的过程。
3. 对于图形验证码来说，它们都是一些不规则的字符，这些字符确实是由字符稍加扭曲变换得到的内容。
4. 对于验证码，我们可以使用 OCR 技术来将其转化为电子文本，然后爬虫将识别结果提交给服务器，便可以达到自动识别验证码的过程。
5. tesserocr 是 Python 的一个 OCR 识别库，但其实是对 tesseract 做的一层 Python API 封装，所以它的核心是 tesseract 。
6. 因此，在安装 tesserocr之前，我们需要先安装 tesseract 。
7. 相关链接
```
(1) tesserocr GitHub: https://github.com/sirfz/tesserocr
(2) tesserocr PyPI: https://pypi.python.org/pypi/tesserocr
(3) tesseract 下载地址: http://digi.bib.uni-mannheim.de/tesseract
(4) tesseract GitHub: https://github.com/tesseract-ocr/tesseract
(5) tesseract 语言包: https://github.com/tesseract-ocr/tessdata
(6) tesseract 文档: https://github.com/tesseract-ocr/tesseract/wiki/Documentation
```

#### Windows 下安装
1. 在 Windows 下，首先需要下载 tesseract ，它为 tesserocr 提供了支持。进入下载页面，可以看到有各种 .exe 文件的下载列表，这里可以选择下载 3.0 版本。
2. 其中文件名中带有 dev 的为开发版本，不带 dev 的为稳定版本，可以选择下载不带 dev 的版本。
3. 下载完成后双击，此时可以勾选 Additional language data(download 选项) 来安装 OCR 识别支持的语言包，这样 OCR 便可以识别多国语言，然后一路点击 Next 按钮即可。
4. 接下来，再安装 tesserocr 即可，此时直接使用 pip 安装：
```
pip3 install tesserocr pillow
```

#### Linux 下安装
1. 对于 Linux 来说，不同系统已经有了不同的发行包了，它可能叫作 tesseract-ocr 或者 tesseract ，直接用对应的命令安装即可。
- Ubuntu、Debian 和 Deepin
```
(1) 在 Ubuntu、Debian 和 Deepin 系统下，安装命令如下：
sudo apt-get install -y tesseract-ocr libtesseract-dev libleptonica-dev
```
- CentOS、Red Hat
```
(1) 在 CentOS 和 Red Hat 系统下，安装命令如下：
yum install -y tesseract
(2) 接着，我们查看一下其支持的语言：
tesseract --list-langs
(3) 运行结果示例：
List of available languages (3):
eng
osd
equ
(4) 结果显示它只支持几种语言，如果想要安装多国语言，还需要安装语言包，官方叫作 tessdata 。(其下载链接为: https://github.com/tesseract-ocr/tessdata)。
# 利用 Git 命令将其下载下来并迁移到相关目录即可，不同版本的迁移命令如下所示。
# 在 Ubuntu、Debian 和 Deepin 系统下的迁移命令如下： 
git clone https://github.com/tesseract-ocr/tessdata.git 
sudo mv tessdata/* /usr/share/tesseract-ocr/tessdata
# 在 CentOS 和 Red Hat 系统下的迁移命令如下：
git clone https://github.com/tesseract-ocr/tessdata.git 
sudo mv tessdata/* /usr/share/tesseract/tessdata
(5) 这时我们重新运行列出所有语言的命令：
tesseract --list-langs
(6) 结果如下：
List of available languages (107):
afr
amh
ara
asm
...
(7) 可以发现，这里列出的语言就多了很多，比如 chi_sim 就代表简体中文，这就证明语言包安装成功了。
(8) 接下来再安装 tesserocr 即可，这里直接使用 pip 安装：
pip3 install tesserocr pillow
```

#### Mac 下安装
1. 在 Mac 下，我们首先使用 Homebrew 安装 ImageMagick 和 tesseract 库：
```
brew install imagemagick 
brew install tesseract --all-languages
```
2. 接下来再安装 tesserocr 即可：
```
pip3 install tesserocr pillow
```

#### 验证安装
1. 接下来，我们可以使用 tesseract 和 tesserocr 来分别进行测试。
2. 下面我们以某图片为样例进行测试。该图片的链接为：https://raw.githubusercontent.com/Python3WebSpider/TestTess/master/image.png，可以直接保存或下载。
3. 首先用命令行进行测试，将图片下载下来并保存为 image.png ，然后用 tesseract 命令测试：
```
tesseract image.png result -l eng && cat result.txt
```
4. 运行结果如下：
```
Tesseract Open Source OCR Engine v3.05.01 with Leptonica
Python3WebSpider
```
5. 这里我们调用了 tesseract 命令，其中第一个参数为图片名称，第二个参数 result 为结果保存的目标文件名称，－l 指定使用的语言包，在此使用英文。
6. 然后，再用 cat 命令将结果输出。运行结果便是图片的识别结果：Python3WebSpider 。可以看到，这时已经成功将图片文字转为电子文本了。
7. 然后还可以利用 Python 代码来测试，这里就需要借助于 tesserocr 库了，测试代码如下：
```
# 我们首先利用 Image 读取了图片文件，然后调用了 tesserocr 的 image_to_text() 方法，再将其识别结果输出 。
import tesserocr 
from PIL import Image 
image = Image.open('image.png') 
print(tesserocr.image_to_text(image))
```
8. 运行结果如下：
```
Python3WebSpider
```
9. 另外，我们还可以直接调用 `file_to_text()` 方法，这可以达到同样的效果：
```
import tesserocr 
print(tesserocr.file_to_text('image.png'))
```
10. 如果成功输出结果，则证明 tesseract 和 tesserocr 都已经安装成功。

## 数据库安装
1. 作为数据存储的重要部分，数据库同样是必不可少的，数据库可以分为关系型数据库和非关系型数据库。
2. 关系型数据库如 SQLite、MySQL、Oracle、SQL Server、DB2 等，其数据库是以表的形式存储；非关系型数据库如 MongoDB、Redis ，它们的存储形式是键值对，存储形式更加灵活。
3. 本书用到的数据库主要有关系型数据库 MySQL 及非关系型数据库 MongoDB、Redis 。

### MySQL 的安装
1. MySQL 是一个轻量级的关系型数据库，本节中我们来了解下它的安装方式。
2. 相关链接
```
(1) 官方网站: https://www.mysql.com/cn
(2) 下载地址: https://www.mysql.com/cn/downloads
(3) 中文教程: http://www.runoob.com/mysql/mysql-tutorial.html
```

#### Windows 下安装
1. 对于 Windows 来说，可以直接在百度软件中心搜索 MySQL ，下载其提供的 MySQL 安装包，速度还是比较快的。
2. 当然，最安全稳妥的方式是直接到官网下载安装包进行安装，但是这样做有个缺点，那就是需要登录才可以下载，而且速度不快。
3. 下载完成后，双击安装包即可安装，这里直接选择默认选项，点击 Next 按钮安装即可。
4. 安装完成后，我们可以在 “计算机” → “管理” → “服务” 页面开启和关闭MySQL服务。
5. 如果启动了MySQL服务，就可以使用它来存储数据了。

#### Linux 下安装
- Ubuntu、Debian 和 Deepin
```
(1) 在 Ubuntu、Debian 和 Deepin 系统中，我们直接使用 apt-get 命令即可安装 MySQL ：
sudo apt-get update
sudo apt-get install -y mysql-server mysql-client
(2) 在安装过程中，会提示输入用户名和密码，输入后等待片刻即可完成安装。
(3) 启动、关闭和重启 MySQL 服务的命令如下：
sudo service mysql start
sudo service mysql stop
sudo service mysql restart
```
- CentOS 和 Red Hat
```
(1) 这里以 MySQL5.6 的 Yum 源为例来说明(如果需要更高版本，可以另寻)，安装命令如下：
wget http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm
sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm
yum install -y mysql mysql-server
(2) 运行如上命令即可完成安装，初始密码为空。 接下来，需要启动MySQL服务。
(3) 启动 MySQL 服务的命令如下：
sudo systemctl start mysqld
(4) 停止、重启 MySQL 服务的命令如下：
sudo systemctl stop mysqld 
sudo systemctl restart mysqld
(5) 上面我们完成了 Linux 下 MySQL 的安装，之后可以修改密码，此时可以执行如下命令：
mysql -u root -p
(6) 输入密码后，进入 MySQL 命令行模式，接着输入如下命令：
use mysql;
UPDATE user SET Password = PASSWORD('newpass') WHERE user ='root';
FLUSH PRIVILEGES;
(7) 其中 newpass 为修改的新的MySQL密码，请自行替换。
(8) 由于 Linux 一般会作为服务器使用，为了使 MySQL 可以被远程访问，我们需要修改 MySQL 的配置文件，配置文件的路径一般为 /etc/mysql/my.cnf 。
vi /etc/mysql/my.cnf
(9) 注释此行：
bind-address = 127.0.0.1
(10) 此行限制了 MySQL 只能本地访问而不能远程访问，注释掉即可解除此限制。
(11) 修改完成后重启 MySQL 服务，此时 MySQL 就可以被远程访问了。
```

#### Mac 下安装
1. 这里推荐使用 Homebrew 安装，直接执行 brew 命令即可：
```
brew install mysql
```
2. 启动、停止和重启 MySQL 服务的命令如下：
```
sudo mysql.server start
sudo mysql.server stop 
sudo mysql.server restart
```
3. Mac 一般不会作为服务器使用，如果想取消本地 host 绑定，那么需要修改 my.cnf 文件，然后重启服务。

### MongoDB 安装
1. MongoDB 是由 C++ 语言编写的非关系型数据库，是一个基于分布式文件存储的开源数据库系统，其内容存储形式类似 JSON 对象，它的字段值可以包含其他文档、数组及文档数组，非常灵活。
2. MongoDB 支持多种平台，包括 Windows、Linux、MacOS、Solaris 等，在其[官方网站](!https://www.mongodb.com/download-center)均可找到对应的安装包。
3. 相关链接
```
(1) 官方网站: https://www.mongodb.com
(2) 官方文档: https://docs.mongodb.com
(3) GitHub: https://github.com/mongodb
(4) 中文教程: http://www.runoob.com/mongodb/mongodb-tutorial.html
```

#### Windows 下安装
1. 这里在官网点击 DOWNLOAD 按钮下载 msi 安装包即可。
2. 下载完成后，双击它开始安装，指定 MongoDB 的安装路径，例如此处我指定的安装路径为 C:\MongoDB\Server\3.4 。
3. 安装成功之后，进入 MongoDB 的安装目录，此处是 C:\MongoDB\Server\3.4 ，在 bin 目录下新建同级目录 data ，然后进入 data 文件夹，新建子文件夹 db 来存储数据目录。
4. 之后打开命令行，进入 MongoDB 安装目录的 bin 目录下，运行 MongoDB 服务：
```
mongod --dbpath "C:\MongoDB\Server\3.4\data\db"
```
5. 接下来还需将 MongoDB 配置成系统服务。
6. 首先，以管理员模式运行命令行。在“开始”菜单中搜索 cmd ，找到命令行，然后右击它以管理员身份运行即可。
7. 随后新建一个日志文件，在 bin 目录新建 logs 同级目录，进入之后新建一个 mongodb.log 文件，用于保存 MongoDB 的运行日志。
8. 在命令行下输入如下内容：
```
mongod --bind_ip 0.0.0.0 --logpath "C:\MongoDB\Server\3.4\logs\mongodb.log" --logappend --dbpath "C:MongoDB\Server\3.4\data\db" --port 27017 --serviceName "MongoDB" --serviceDisplayName "MongoDB" --install
```
9. 这里的意思是绑定IP为 0.0.0.0 (即任意 IP 均可访问)，指定日志路径、数据库路径和端口，指定服务名称。
10. 需要注意的是，这里依然需要把路径替换成你的 MongoDB 安装路径，运行此命令后即可安装服务。

#### Linux 下安装
1. 这里以 MongoDB3.4 为例说明 MongoDB 安装过程。
- Ubuntu
```
(1) 首先，导入 MongoDB 的 GPG key：
sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv OC49F3730359A14518S85931BC711F9BA15703C6
(2) 随后创建 apt-get 源列表，各个系统版本对应的命令分别如下。
(3) Ubuntu 12.04 对应的命令如下：
echo "deb [arch=amd64] http://repo.mongodb.org/apt/ubuntu precise/mongodb-org/3.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list
(4) Ubuntu 14.04 对应的命令如下:
echo "deb [arch=amd64] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list
(5) Ubuntu 16.04 对应的命令如下：
echo "deb [arch=amd64,arm64] http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-3.4.list
(6) 随后更新 apt-get 源：
sudo apt-get update
(7) 之后安装 MongoDB 即可：
sudo apt-get install -y mongodb-org
(8) 安装完成后运行 MongoDB ，命令如下：
mongod --port 27017 --dbpath /data/db
(9) 运行命令之后，MongoDB 就在27017端口上运行了，数据文件会保存在 /data/db 路径下。
(10) 一般情况下，我们在 Linux上 配置 MongoDB 都是为了远程连接使用的，所以这里还需要配置一下 MongoDB 的远程连接以及用户名和密码。
(11) 接着，进入 MongoDB 命令行：
mongo --port 27017
(12) 现在我们就已经进入到 MongoDB 的命令行交互模式下了，在此模式下运行如下命令：
> use admin
switched to db admin
> db.createUser({user: 'admin', pwd: 'admin123', roles: [{role: 'root', db: 'admin'}]})
(13) 这样我们就创建了一个用户名为 admin ，密码为 adminl23 的用户，赋予最高权限。
(14) 随后需要修改 MongoDB 的配置文件，此时执行如下命令：
sudo vi /etc/mongod.conf
(15) 然后修改net部分为：
net:
  port: 27017 
  bindip: 0.0.0.0
(16) 这样配置后，MongoDB 可被远程访问。另外，还需要添加如下的权限认证配置。此时直接添加如下内容到配置文件即可：
security:
  authorization: enabled
(17) 配置完成之后，我们需要重新启动 MongoDB 服务，命令如下：
sudo service mongod restart
(18) 这样远程连接和权限认证就配置完成了。
```
- CentOS 和 Red Hat
```
(1) 首先，添加 MongoDB 源：
sudo vi /etc/yum.repos.d/mongodb-org.repo
(2) 接着修改如下内容并保存：
[mongodb-org-3.4]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/readhat/$releaserver/mongodb-org/3.4/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-3.4.asc
(3) 然后执行 yum 命令安装：
sudo yum install mongodb-org
(4) 这里启动 MongoDB 服务的命令如下：
sudo systemctl start mongod
(5) 停止和重新加载 MongoDB 服务的命令如下：
sudo systemctl stop mongod 
sudo systemctl reload mongod
(6) 有关远程连接和认证配置，可以参考前面，方式是相同的。
```

#### Mac 下的安装
1. 这里推荐使用 Homebrew 安装，直接执行 brew 命令即可：
```
brew install mongodb
```
2. 然后创建一个新文件夹 /data/db ，用于存放 MongoDB 数据。这里启动 MongoDB 服务的命令如下：
```
brew services start mongodb 
sudo mongod
```
3. 停止和重启 MongoDB 服务的命令分别是：
```
brew services stop mongodb 
brew services restart mongodb
```

#### 可视化工具
1. 这里推荐一个可视化工具 RoboMongo/Robo 3T ，它使用简单，功能强大，官方网站为 https://robomongo.org/ ，三大平台都支持，下载链接为 https://robomongo.org/download 。

### Redis 安装
1. Redis 是一个基于内存的高效的非关系型数据库，本节中我们来了解一下它在各个平台的安装过程。
2. 相关链接
```
(1) 官方网站: https://redis.io
(2) 官方文档: https://redis.io/documentation
(3) 中文官网: https://www.redis.cn
(4) GitHub: https://github.com/antirez/redis
(5) 中文教程: http://www.runoob.com/redis/redis-tutorial.html
(6) Redis Desktop Manager: https://redisdesktop.com
(7) Redis Desktop Manager GitHub: https://github.com/uglide/RedisDesktopManager
```

#### Windows 下安装
1. 在 Windows 下，Redis 可以直接到 GitHub 的发行版本里面下载，具体下载地址是 https://github.com/MSOpenTech/redis/releases 。
2. 打开下载页面后，可以下载 Redis-x64-3.2.100.msi 安装即可。安装过程比较简单，直接点击 Next 按钮安装即可。安装完成后，Redis 便会启动。
3. 另外，推荐下载 Redis Desktop Manager 可视化管理工具，来管理 Redis 。
4. 这既可以到[官方网站](!https://redisdesktop.com/download)下载，也可以到 [GitHub](!https://github.com/uglide/RedisDesktopManager/releases) 下载最新发行版本。
5. 安装后，直接连接本地 Redis 即可。

#### Linux 下安装
- Ubuntu、Debian 和 Deepin
```
(1) 在 Ubuntu、Debian 和 Deepin 系统下，使用 apt-get 命令安装 Redis :
sudo apt-get -y install redis-server
(2) 然后输入 redis-cli 进入 Redis 命令行模式:
$ redis-cli 
121.0.0.1:6379> set 'name' 'Germey'
OK
121.0.0.1:6379> get 'name' 
"Germey"
(3) 这样就证明 Redis 成功安装了，但是现在 Redis 还是无法远程连接的，依然需要修改配置文件，配置文件的路径为／etc/redis/redis.conf。
(4) 首先，注释这一行：
bind 127.0.0.1
(5) 另外，推荐给 Redis 设置密码，取消注释这一行：
requirepass foobared
(6) foobared 即当前密码，可以自行修改。然后重启 Redis 服务，使用的命令如下：
sudo /etc/init.d/redis-server restart
(7) 现在就可以使用密码远程连接 Redis 了。另外，停止和启动 Redis 服务的命令分别如下：
sudo /etc/init.d/redis-server stop 
sudo /etc/init.d/redis-server start
```
- CentOS 和 Red Hat
```
(1) 在 CentOS 和 Red Hat 系统中，首先添加 EPEL 仓库，然后更新 yum 源：
sudo yum install epel-release
sudo yum update
(2) 然后安装 Redis 数据库：
sudo yum -y install redis
(3) 安装好后启动 Redis 服务即可：
sudo systemctl start redis
(4) 这里同样可以使用 redis-cli 进入 Redis 命令行模式操作。另外，为了可以使 Redis 能被远程连接，需要修改配置文件，路径为 /etc/redis.conf 。参见上文来修改配置文件实现远程连接和密码配置。修改完成之后保存。
(5) 然后重启 Redis 服务即可，命令如下：
sudo systemctl restart redis
```

#### Mac 下安装
1. 这里推荐使用 Homebrew 安装，直接执行如下命令即可：
```
brew install redis
```
2. 启动 Redis 服务的命令如下：
```
brew services start redis 
redis-server /usr/local/etc/redis.conf
```
3. 这里同样可以使用 redis-cli 进入 Redis 命令行模式。在 Mac 下 Redis 的配置文件路径是 /usr/local/etc/redis.conf ，可以通过修改它来配置访问密码。
4. 修改配置文件后，需要重启 Redis 服务。停止和重启 Redis 服务的命令分别如下：
```
brew services stop redis 
brew services restart redis
```
5. 另外，在 Mac 下也可以安装 Redis Desktop Manager 可视化管理工具来管理 Redis 。

## 存储库安装
1. 我们介绍了几个数据库的安装方式，但这仅仅是用来存储数据的数据库，它们提供了存储服务，但如果想要和 Python 交互的话，还需要安装一些 Python 存储库，如 MySQL 需要安装 PyMySQL ，MongoDB 需要安装 PyMongo 等。
2. 本节中，我们来说明一下这些存储库的安装方式。

### PyMySQL 安装
1. 在 Python3 中，如果想要将数据存储到 MySQL 中，就需要借助 PyMySQL 来操作，本节中我们介绍一下它的安装方式。
2. 相关链接
```
(1) GitHub: https://github.com/PyMySQL/PyMySQL
(2) 官方文档: http://pymysql.readthedocs.io/
(3) PyPI: https://pypi.python.org/pypi/PyMySQL
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install pymysql
```

#### 验证安装
1. 为了验证库是否已经安装成功，可以在命令行下测试一下。这里首先输入 python3 ，进入命令行模式，接着输入如下内容：
```
$ python3
>> import pymysql
>> pymysql.VERSION
(0, 7, 11, None)
```
2. 如果成功输出了其版本内容，那么证明 PyMySQL 成功安装。

### PyMongo 安装
1. 在 Python 中，如果想要和 MongoDB 进行交互，就需要借助于 PyMongo 库，这里就来了解一下它的安装方法。
2. 相关链接
```
(1) GitHub: https://github.com/mongodb/mongo-python-driver
(2) 官方文档: https://api.mongodb.com/python/current/
(3) PyPI: https://pypi.python.org/pypi/pymongo
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install pymongo
```

#### 验证安装
1. 为了验证 PyMongo 库是否已经安装成功，可以在命令行下测试一下：
```
$ python3
>> import pymongo
>> pymongo.version
'3.4.0'
```
2. 如果成功输出了其版本内容，那么证明成功安装。

### redis-py 安装
1. 对于 Redis 来说，我们要使用 redis-py 库来与其交互，这里就来介绍一下它的安装方法。
2. 相关链接
```
(1) GitHub: https://github.com/andymccurdy/redis-py
(2) 官方文档: https://redis-py.readthedocs.io/
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install redis
```

#### 验证安装
1. 为了验证 redis-py 库是否已经安装成功，可以在命令行下测试一下：
```
$ python3
>> import redis
>> redis.VERSION 
(2, 10, 5)
```

### RedisDump 安装
1. RedisDump 是一个用于 Redis 数据导入/导出的工具，是基于 Ruby 实现的，所以要安装 RedisDump ，需要先安装 Ruby 。
2. 相关链接
```
1. GitHub: https://github.com/delano/redis-dump
2. 官方文档: http://delanotes.com/redis-dump
```

#### Ruby 安装
1. 有关 Ruby 的安装方式可以参考 http://www.ruby-lang.org/zh_cn/documentation/installation ，这里列出了所有平台的安装方式，可以根据对应的平台选用合适的安装方式。

#### gem 安装
1. 安装完成之后，就可以执行 gem 命令了，它类似于 Python 中的 pip 命令。
2. 利用 gem 命令，我们可以安装 RedisDump ，具体如下：
```
gem install redis-dump
```

#### 验证安装
1. 安装成功后，就可以执行如下两个命令：
```
redis-dump 
redis-load
```
2. 如果可以成功调用，则证明安装成功。

## Web 库安装
1. 对于 Web ，我们应该都不陌生，现在日常访问的网站都是 Web 服务程序搭建而成的。
2. Python 同样不例外，也有一些这样的 Web 服务程序，比如 Flask、Django 等，我们可以拿它来开发网站和接口等。
3. 在本书中，我们主要使用这些 Web 服务程序来搭建一些 API 接口，供我们的爬虫使用。
4. 书中用到的一些 Web 服务程序主要有 Flask 和 Tornado ，这里就分别介绍它们的安装方法。

### Flask 安装
1. Flask 是一个轻量级的 Web 服务程序，它简单、易用、灵活，这里主要用来做一些 API 服务。
2. 相关链接
```
(1) GitHub: https://github.com/pallets/flask
(2) 官方文档: http://flask.pocoo.org
(3) 中文文档: http://docs.jinkan.org/docs/flask
(4) PyPI: https://pypi.python.org/pypi/Flask
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install flask
```

#### 验证安装
1. 安装成功后，可以运行如下实例代码测试一下：
```
from flask import Flask 

app = Flask(__name__）
@app.route("/")

def hello():
  return "Hello World!"

if __name__ == '__main__':
  app.run()
```
2. 可以发现，系统会在 5000 端口开启 Web 服务，控制台输出如下：
```
* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```
3. 直接访问 http://127.0.0.1:5000/ ，可以观察到网页中呈现了 Hello World! ，一个最简单的 Flask 程序就运行成功了。

### Tornado 安装
1. Tornado 是一个支持异步的 Web 框架，通过使用非阻塞 I/O 流，它可以支撑成千上万的开放连接，效率非常高，本节就来介绍一下它的安装方式。
2. 相关链接
```
(1) GitHub: https://github.com/tomadoweb/tornado
(2) PyPI: https://pypi.python.org/pypi/tornado
(3) 官方文档: http://www.tornadoweb.org
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install tornado
```

#### 验证安装
1. 同样，这里也可以用一个 Hello World 程序测试一下，代码如下：
```
import tornado.ioloop 
import tornado.web

class MainHandler(tornado.web.RequestHandler):
  def get(self):
    self.write("Hello, world")
def make_app():
  return tornado.web.Application([
    (r"/", MainHandler),
  ])

if __name__ == '__main__':
  app ＝ make_app()
  app.listen(8888)
  tornado.ioloop.IOLoop.current().start()
```
2. 直接运行程序，可以发现系统在 8888 端口运行了 Web 服务，控制台没有输出内容，此时访问 http://127.0.0.1:8888/ ，可以观察到网页中呈现了 Hello,world ，这就说明 Tornado 成功安装了。

## App 爬取相关库安装
1. 除了 Web 网页，爬虫也可以抓取 App 的数据。App 中的页面要加载出来，首先需要获取数据，而这些数据一般是通过请求服务器的接口来获取的。
2. 由于 App 没有浏览器这种可以比较直观地看到后台请求的工具，所以主要用一些抓包技术来抓取数据。
3. 本书介绍的抓包工具有 Charles、mitmproxy 和 mitmdump 。一些简单的接口可以通过 Charles 或 mitmproxy 分析，找出规律，然后直接用程序模拟来抓取了。但是如果遇到更复杂的接口，就需要利用 mitmdump 对接 Python 来对抓取到的请求和响应进行实时处理和保存。
4. 另外，既然要做规模采集，就需要自动化 App 的操作而不是人工去采集，所以这里还需要一个工具叫作 Appium ，它可以像 selenium 一样对 App 进行自动化控制，如自动化模拟 App 的点击、下拉等操作。
5. 本节中，我们就来介绍一下 Charles、mitmproxy、mitmdump、Appium 的安装方法。

### Charles 安装
1. Charles 是一个网络抓包工具，相比 Fiddler ，其功能更为强大，而且跨平台支持得更好，所以这里选用它来作为主要的移动端抓包工具。
2. 相关链接
```
(1) 官方网站: https://www.charlesproxy.com
(2) 下载链接: https://www.charlesproxy.com/download
```

#### Charles 下载
1. 我们可以在官网下载最新的稳定版本，可以发现，它支持 Windows、Linux 和 Mac 三大平台。

#### 证书配置
1. 现在很多页面都在向 HTTPS 方向发展，HTTPS 通信协议应用得越来越广泛。如果一个 App 通信应用了 HTTPS 协议，那么它通信的数据都会是被加密的，常规的截包方法是无法识别请求内部的数据的。
2. 安装完成后，如果我们想要做 HTTPS 抓包的话，那么还需要配置一下相关 SSL 证书。接下来，我们再看看各个平台下的证书配置过程。
3. Charles 是运行在 PC 端的，我们要抓取的是 App 端的数据，所以要在 PC 和手机端都安装证书。

##### Windows
1. 如果你的 PC 是 Windows 系统，可以按照下面的操作进行证书配置。首先打开 Charles ，点击 Help -> SSL Proxying -> Install Charles Root Certificate ，即可进入证书的安装页面。
2. 接下来，会弹出一个安装证书的页面，点击“安装证书”按钮，就会打开证书导入向导，直接点击“下一步”按钮，此时需要选择证书的存储区域，点击第二个选项“将所有的证书放入下列存储”，然后点击“浏览”按钮，从中选择证书存储位置为“受信任的根证书颁发机构”，再点击“确定”按钮，然后点击“下一步”按钮，再继续点击“下一步”按钮完成导入。

##### Mac
1. 如果你的 PC 是 Mac 系统，可以按照下面的操作进行证书配置。同样是点击 Help -> SSL Proxying -> Install Charles Root Certificate ，即可进入证书的安装页面。
2. 接下来，找到 Charles 的证书并双击，将“信任”设置为“始终信任”即可，这样就成功安装了证书。

##### ios
1. 如果你的手机是 ios 系统，可以按照下面的操作进行证书配置。
2. 首先，查看电脑的 Charles 代理是否开启，具体操作是点击 Proxy → Proxy Settings ，打开代理设置页面，确保当前的 HTTP 代理是开启的。这里的代理端口为 8888 ，也可以自行修改。
3. 接下来，将手机和电脑连在同一个局域网下。例如，当前电脑的 IP 为 192.168.1.76 ，那么首先设置手机的代理为 192.168.1.76:8888 ，设置完毕后，电脑上会出现一个提示窗口，询问是否信任此设备，此时点击 Allow 按钮即可。
4. 这样手机就和 PC 连在同一个局域网内了，而且设置了 Charles 的代理，即 Charles 可以抓取到流经 App 的数据包了。
5. 接下来，再安装 Charles 的 HTTPS 证书。在电脑上打开 Help -> SSL Proxying -> Install Charles Root Certificate on a Mobile Device or Remote Browser，它提示我们在手机上设置好 Charles 的代理(刚才已经设置好了)，然后在手机浏览器中打开 chls.pro/ssl 下载证书 。
在手机上打开chls.pro/ssl后，便会弹出证书的安装页面，点击“安装”按钮，然后输入密码即可完成安装。
6. 如果你的 ios 版本是 10.3 以下的话，信任 CA 证书的流程就已经完成了。如果你的 ios 版本是 10.3 及以上，还需要在“设置”→“通用”→“关于本机”→“证书信任设置”中将证书的完全信任开关打开。

##### Android
1. 如果你的手机是 Android 系统，可以按照下面的操作进行证书配置。
2. 在 Android 系统中，同样需要设置代理为 Charles 的代理，设置完毕后，电脑上就会出现一个提示窗口，询问是否信任此设备，此时直接点击 Allow 按钮即可。
3. 接下来，像 ios 设备那样，在手机浏览器上打开 chls.pro/ssl ，这时会出现一个提示框，我们为证书添加一个名称，然后点击“确定”按钮即可完成证书的安装。

### mitmproxy 安装
1. mitmproxy 是一个支持 HTTP 和 HTTPS 的抓包程序，类似 Fiddler、Charles 的功能，只不过它通过控制台的形式操作。
2. 此外，mitmproxy 还有两个关联组件，一个是 mitmdump ，它是 mitmproxy 的命令行接口，利用它可以对接 Python 脚本，实现监听后的处理；另一个是 mitmweb ，它是一个 Web 程序，通过它以清楚地观察到 mitmproxy 捕获的请求。
3. 相关链接
```
(1) GitHub: https://github.com/mitmproxy/mitmproxy
(2) 官方网站: https://mitmproxy.org
(3) PyPI: https://pypi.python.org/pypi/mitmproxy
(4) 官方文档: http://docs.mitmproxy.org
(5) mitmdump脚本: http://docs.mitmproxy.org/en/stable/scripting/overview.html
(6) 下载地址: https://github.com/mitmproxy/mitmproxy/releases
(7) DockerHub: https://hub.docker.com/r/mitmproxy/mitmproxy
```

#### pip 安装
1. 最简单的安装方式还是使用 pip ，直接执行如下命令即可安装：
```
pip3 install mitmproxy
```
2. 这是最简单和通用的安装方式，执行完毕之后即可完成 mitmproxy 的安装，另外还附带安装了 mitmdump 和 mitmweb 这两个组件。如果不想用这种方式安装，也可以选择后面列出的专门针对各个平台的安装方式或者 Docker 安装方式。

#### Windows 下安装
1. 可以到 GitHub 上的 Releases 页面(http://github.com/mitmproxy/mitmproxy/releases/)获取安装包，当前的最新版本为 2.0.2 ，则可以选择下载 Windows 下的 exe 安装包 mitmproxy-2.0.2-windowsinstaller.exe ，下载后直接双击安装包即可安装。
2. 注意，在 Windows 上不支持 mitmproxy 的控制台接口，但是可以使用 mitmdump 和 mitmweb 。

#### Linux 下安装
1. 在 Linux 下，可以下载编译好的[二进制包](!https://github.com/mitmproxy/mitmproxy/releases/)，此发行包一般是最新版本，它包含了最新版本的 mitrnproxy 和内置的 Python3 环境，以及最新的 OpenSSL 环境。
2. 如果你的环境里没有 Python3 和 OpenSSL 环境，建议使用此种方式安装。下载之后，需要解压并将其配置到环境变量：
```
tar -zxvf mitmproxy-2.0.2-linux.tar.gz 
sudo mv mitmproxy mitmdump mitmweb /usr/bin
```
3. 这样就可以将 3 个可执行文件移动到了 /usr/bin 目录。而一般情况下，/usr/bin 目录都已经配置在了环境变量下，所以接下来可以直接调用这 3 个工具了。

#### Mac 下安装
1. Mac 下的安装非常简单，直接使用 Homebrew 即可，命令如下
```
brew install mitmproxy
```

#### Docker 下安装
1. mitmproxy 也支持 Docker ，其 DockerHub 的地址为 https://hub.docker.com/r/mitmproxy/mitmproxy/ 。
2. 在 Docker 下，mitmproxy 的安装命令为：
```
docker run --rm -it -p 8080:8080 mitmproxy/mitmproxy mitmdump
```
3. 这样就在 8080 端口上启动了 mitmproxy 和 mitmdump 。如果想要获取 CA 证书，可以选择挂载磁盘选项，命令如下：
```
docker run --rm -it -v ~/.mitmproxy:/home/mitmproxy/.mitmproxy -p 8080:8080 mitmproxy/mitmproxy mitmdump
```
4. 这样就可以在 ~/.mitmproxy 目录下找到 CA 证书。另外，还可以在 8081 端口上启动 mitmweb ，命令如下：
```
docker run --rm it -p 8080:8080 -p 127.0.0.1:8081:8081 mitmproxy/mitmproxy mitmweb
```

##### 证书配置
1. 对于 mitmproxy 来说，如果想要截获 HTTPS 请求，就需要设置证书。
2. mitmproxy 在安装后会提供一套 CA 证书，只要客户端信任了 mitmproxy 提供的证书，就可以通过 mitmproxy 获取 HTTPS 请求的具体内容，否则 mitmproxy 是无法解析 HTTPS 请求的。
3. 首先，运行以下命令产生 CA 证书，并启动 mitmdump :
```
mitmdump
```
4. 接下来，我们就可以在用户目录下的 .mitmproxy 目录里面找到 CA 证书，证书一共 5 个，下表简要说明了这 5 个证书。

|名称|描述|
|:---:|:---:|
|mitmproxy-ca.pem|PEM 格式的证书私钥|
|mitmproxy-ca-cert.pem|PEM 格式证书，适用于大多数非 Windows 平台|
|mitmproxy-ca-cert.p12|PKCS12 格式的证书，适用于 Windows 平台|
|mitmproxy-ca-cert.cer|与 mitmproxy-ca-cert.pem 相同，只是改变了后缀，适用于部分 Android 平台|
|mitmproxy-dhparam.pem|与 PEM 格式的秘钥文件，用于增强 SSL 安全性|

5. 下面我们介绍一下 Windows 、Mac 、ios 和 Anidroid 平台下的证书配置过程。

##### Windows
1. 双击 mitmproxy-ca.p12 ，就会出现导入证书的引导页，直接点击“下一步”按钮即可，会出现密码设置提示，这里不需要设置密码，直接点击“下一步”按钮即可。
2. 接下来需要选择证书的存储区域，这里点击第二个选项“将所有的证书都放入下列存储”，然后点击“浏览”按钮，选择证书存储位置为“受信任的根证书颁发机构”，接着点击“确定”按钮，然后点击“下一步”按钮，这样就在 Windows 下配置完 CA 证书了。

##### Mac
1. Mac 下双击 mitmproxy-ca-cert.pem 即可弹出钥匙串管理页面，然后找到 mitmproxy 证书，打开其设置选项，选择“始终信任”即可。

##### ios
1. 将 mitmproxy-ca-cert.pem 文件发送到 iPhone 上，推荐使用邮件方式发送，然后在 iPhone 上可以直接点击附件并识别安装。
2. 点击“安装”按钮之后，会跳到安装描述文件的页面，点击“安装”按钮，此时会有警告提示，继续点击右上角的“安装”按钮，安装成功之后会有已安装的提示。
3. 如果你的 ios 版本是 10.3 以下的话，此处信任 CA 证书的流程就已经完成了。如果你的 ios 版本是 10.3 及以上版本，还需要在“设置”→“通用”→“关于本机”→“证书信任设置”将 mitmproxy 的完全信任开关打开，此时，在 ios 上配置信任 CA 证书的流程就结束了。

### 安装 Appium
1. Appium 负责驱动移动端来完成一系列操作，对于 ios 设备来说，它使用苹果的 UIAutomation 来实现驱动；对于 Android 来说，它使用 UIAutomator 和 Selendroid 来实现驱动。
2. 同时 Appium 也相当于一个服务器，我们可以向它发送一些操作指令，它会根据不同的指令对移动设备进行驱动，以完成不同的动作。
3. 安装 Appium 有两种方式，一种是直接下载安装包 Appium Desktop 来安装，另一种是通过 Node.js 来安装，下面我们介绍一下这两种安装方式。

#### Appium Desktop 安装
1. Appium Desktop 支持全平台的安装，我们直接从 GitHub 的 Releases 里面安装即可，链接为 https://github.com/appium/appium-desktop/releases 。
2. Windows 平台可以下载 exe 安装包 appium-desktop-Setup-1.1.0.exe ，Mac 平台可以下载 dmg 安装包，如 appium-desktop-1.1.0.dmg ，Linux 平台可以选择下载源码，但是更推荐用 Node.js 安装方式。

#### Node.js 安装
1. 首先需要安装 Node.js，具体的安装方式可以参见 http://www.runoob.com/nodejs/nodejs-installsetup.html ，安装完成之后就可以使用 npm 命令了。
2. 接下来，使用 npm 命令全局安装 Appium 即可：
```
npm install -g appium
```

#### Android 开发环境配置
1. 如果我们要使用 Android 设备做 App 抓取的话，还需要下载和配置 Android SDK ，这里推荐直接安装 Android Studio ，其下载地址为 https://developer.android.com/studio/index.html?hl=zh-cn 。下载后直接安装即可。
2. 然后，我们还需要下载 Android SDK 。直接打开首选项里面的 Android SDK 设置页面，勾选要安装的 SDK 版本，点击 OK 按钮即可下载和安装勾选的 SDK 版本。
3. 另外，还需要配置一下环境变量，添加 ANDROID HOME 为 Android SDK 所在路径，然后再添加 SDK 文件夹下的 tools 和 platform-tools 文件夹到 PATH 中。

#### ios 开发环境
1. 首先需要声明的是，Appium 是一个做自动化测试的工具，用它来测试我们自己开发的 App 是完全没问题的，因为它携带的是开发证书(Development Certificate)。
2. 一般情况下，我们做数据爬取都是使用现有的 App ，在 ios 上一般都是通过 App Store 下载的，它携带的是分发证书(Distribution Certificate)，而携带这种证书的应用都是禁止被测试的，所以只有获取 ipa 安装包再重新签名之后才可以被 Appium 测试，具体的方法这里不再展开阐述。
3. 这里推荐直接使用 Android 来进行测试。如果你可以完成上述重签名操作，那么可以参考如下内容配置 ios 开发环境。
4. Appium 驱动 ios 设备必须要在 Mac 下进行，Windows 和 Linux 平台是无法完成的，所以下面介绍一下 Mac 平台的相关配置。
5. Mac 平台需要的配置如下：
```
(1) macOS 10.12 及更高版本
(2) Xcode 8 及更高版本
```
6. 配置满足要求之后，执行如下命令即可配置开发依赖的一些库和工具：
```
xcode-select --install
```
7. 如果想要用真机进行测试和数据抓取，还需要额外配置其他环境，具体可以参考 https://github.com/appium/appium/blob/master/docs/en/appium-setup/real-devices-ios.md 。

## 爬虫框架安装
1. 我们直接用 requests、selenium 等库写爬虫，如果爬取量不是太大，速度要求不高，是完全可以满足需求的。
2. 但是写多了会发现其内部许多代码和组件是可以复用的，如果我们把这些组件抽离出来，将各个功能模块化，就慢慢会形成一个框架雏形，久而久之，爬虫框架就诞生了。
3. 利用框架，我们可以不用再去关心某些功能的具体实现，只需要关心爬取逻辑即可。有了它们，可以大大简化代码，而且架构也会变得清晰，爬取效率也会高许多。所以，如果有一定的基础，上手框架是一种好的选择。
4. 本书主要介绍的爬虫框架有 pyspider 和 Scrapy 。本节中，我们来介绍一下 pyspider、Scrapy 及其扩展库的安装方式。

### pyspider 安装
1. pyspider 是国人 binux 编写的强大的网络爬虫框架，它带有强大的 WebUI 、脚本编辑器、任务监控器、项目管理器以及结果处理器，同时支持多种数据库后端、多种消息队列，另外还支持 JavaScript 渲染页面的爬取，使用起来非常方便，本节介绍一下它的安装过程。
2. 相关链接
```
(1) 官方文档: http://docs.pyspider.org/
(2) PyPI: https://pypi.python.org/pypi/pyspider
(3) GitHub: https://github.corn/binux/pyspider
(4) 官方教程: http://docs.pyspider.org/en/latest/tutorial
(5) 在线实例: http://demo.pyspider.org
```

#### 准备工作
1. pyspider 是支持 JavaScript 渲染的，而这个过程是依赖于 PhantomJS 的，所以还需要安装 PhantomJS 。

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install pyspider
```

#### 常见错误
1. Windows 下可能会出现这样的错误提示：
```
Command "python setup.py egg_info" failed with error code 1 in /tmp/pip-build-vXo1W3/pycurl
```
2. 这是 PyCurl 安装错误，此时需要安装 PyCurl 库。
3. 从 http://www.lfd.uci.edu/.～gohlke/pythonlibs/#pycurl 找到对应的 Python 版本，然后下载相应的 wheel 文件即可。比如 Windows 64位、Python 3.6，则需要下载 pycurl-7.43.0-cp36-cp36m-win_amd64.whl ，随后用 pip 安装即可，命令如下：
```
pip3 install pycurl-7.43.0-cp36-cp36m win_amd64.whl
```

#### 验证安装
1. 安装完成之后，可以直接在命令行下启动 pyspider：
```
pyspider all
```
2. 这时 pyspider 的 Web 服务就会在本地 5000 端口运行。直接在浏览器中打开 http://localhost:5000/ , 即可进入 pyspider 的 WebUI 管理页面，这证明 pyspider 已经安装成功了。

### Scrapy 安装
1. Scrapy 是一个十分强大的爬虫框架，依赖的库比较多，至少需要依赖的库有 Twisted 14.0、lxml 3.4 和 pyOpenSSL0.14 。
2. 在不同的平台环境下，它所依赖的库也各不相同，所以在安装之前，最好确保把一些基本库安装好。本节就来介绍 Scrapy 在不同平台的安装方法。
3. 相关链接
```
(1) 官方网站: https://scrapy.org
(2) 官方文档: https://docs.scrapy.org
(3) PyPI: https://pypi.python.org/pypi/Scrapy
(4) GitHub: https://github.com/scrapy/scrapy
(5) 中文文档: http://scrapy-chs.readthedocs.io
```

#### Anaconda 安装
1. 这是一种比较简单的安装 Scrapy 的方法(尤其是对于 Windows 来说)，如果你的 Python 是使用 Anaconda 安装的，或者还没有安装 Python 的话，可以使用此方法安装，这种方法简单、省力。当然，如果你的 Python 不是通过 Anaconda 安装的，可以继续看后面的内容。
2. 关于 Anaconda 的安装方式，在此不再赘述。如果已经安装好了 Anaconda ，那么可以通过 conda 命令安装 Scrapy ，具体如下：
```
conda install Scrapy
```

#### Windows 下安装
1. 如果你的 Python 不是使用 Anaconda 安装的，可以参考如下方式来一步步安装 Scrapy 。

##### 安装 lxml
1. lxml 的安装过程看之前。

##### 安装 pyOpenSSL
1. 在官方网站下载 wheel 文件(详见 https://pypi.python.org/pypi/pyOpenSSL#downloads )，下载后利用 pip 安装即可：
```
pip3 install pyOpenSSL-17.2.0-py2.py3-none-any.whl
```

##### 安装 twisted
1. 到 http://www.lfd.uci.edu/～gohlke/pythonlibs/#twisted 下载 wheel 文件，利用 pip 安装即可。
```
pip3 install Twisted-17.5.0-cp36-cp36m-win_amd64.whl
```

##### 安装 PyWin32
1. 从官方网站下载对应版本的安装包即可，链接为：https://sourceforge.net/projects/pywin32/files/pywin32/Build%20221/ ，下载完成后点击安装即可。

##### 安装 Scrapy
1. 安装好了以上的依赖库后，安装 Scrapy 就非常简单了，这里依然使用 pip ，命令如下：
```
pip3 install Scrapy
```

#### Linux 下安装
- CentOS 和 Red Hat
```
(1) 在 CentOS 和 Red Hat 下，首先确保一些依赖库已经安装，运行如下命令：
sudo yum groupinstall -y development tools 
sudo yum install -y epel-release libxslt-devel libxml2-devel openssl-devel
(2) 最后利用 pip 安装 Scrapy 即可：
pip3 install Scrapy
```
- Ubuntu、Debian 和 Deepin
```
(1) 在 Ubuntu、Debian 和 Deepin 平台下，首先确保一些依赖库已经安装，运行如下命令：
sudo apt-get install build-essential python3-dev libssl-dev libffi-dev libxml2 libxml2-dev libxslt1-dev zliblg-dev
(2) 最后利用 pip 安装 Scrapy 即可：
pip3 install Scrapy
```

#### Mac 下的安装
1. 在 Mac 下，首先也是进行依赖库的安装。在 Mac 上构建 Scrapy 的依赖库需要 C 编译器以及开发头文件，它一般由 Xcode 提供，具体命令如下：
```
xcode-select --install
```
2. 最后利用 pip 安装 Scrapy 即可：
```
pip3 install Scrapy
```

#### 常见错误
1. 在安装过程中，常见的错误汇总如下。
2. 错误一：
```
pkg_resources.VersionConflict:(six 1.5.2 (/usr/lib/python3/dist-packagees), Requirement.parse ('six>=1.6.0'))
```
3. 这是 six 包版本过低出现的错误。six 包是一个提供兼容 Python2 和 Python3 的库，这时升级 six 即可。
```
sudo pip3 install -U six
```
4. 错误二：
```
c/_cffi_backend.c:15:17:fatal error:ffi.h: No such file or directory
```
5. 这是在 Linux 下常出现的错误，缺少 libffi 库造成的。
6. 而 libffi 库只提供了最底层的、与架构相关的、完整的 FFI 。此时安装相应的库即可。
7. 在 Ubuntu 和 Debian 下，直接执行如下命令即可
```
sudo apt-get install build-essential libssl-dev libffi-dev python3-dev
```
8. 在 CentOS 和 Red Hat 下，直接执行如下命令即可：
```
sudo yum install gcc libffi-devel python-devel openssl-devel
```
9. 错误三：
```
Command "python setup.py egg_info" failed with error code 1 in /tmp/pip-build/cryptography/
```
10. 这是缺少加密的相关组件，此时利用 pip 安装即可：
```
pip3 install cryptography
```
11. 错误四：
```
Import Error: No module named 'packaging'
```
12. 这是因为缺少 packaging 包出现的错误，这个包提供了 Python 包的核心功能，此时利用 pip 安装。
13. 错误五：
```
ImportError: No module named '_cffi_backend'
```
14. 这个错误表示缺少 cffi 包，直接使用 pip 安装即可：
```
pip3 install cffi
```
15. 错误六：
```
ImportError: No module named 'pyparsing'
```
16. 这个错误表示缺少 pyparsing 包，直接使用 pip 安装即可：
```
pip3 install pyparsing appdirs
```

#### Scrapy-Splash 安装
1. Scrapy-Splash 是一个 Scrapy 中支持 JavaScript 渲染的工具，本节来介绍它的安装方式。
2. Scrapy-Splash 的安装分为两部分。一个是 Splash 服务的安装，具体是通过 Docker ，安装之后，会启动一个 Splash 服务，我们可以通过它的接口来实现 JavaScript 页面的加载。另外一个是 Scrapy-Splash 的 Python 库的安装，安装之后即可在 Scrapy 中使用 Splash 服务。
3. 相关链接
```
(1) GitHub: https://github.com/scrapy-plugins/scrapy-splash
(2) PyPI: https://pypi.python.org/pypi/scrapy-splash
(3) 使用说明: https://github.com/scrapy-plugins/scrapy-splash#configuration
(4) Splash官方文档: http://splash.readthedocs.io
```

##### 安装 Splash
1. Scrapy-Splash 会使用 Splash 的 HTTP API 进行页面渲染，所以我们需要安装 Splash 来提供渲染服务。这里通过 Docker 安装，在这之前请确保已经正确安装好了 Docker 。
2. 安装命令如下：
```
docker run -p 8050:8050 scrapinghub/splash
```
3. 这时我们打开 http://localhost:8050 ，即可看到 Splash 的主页。
4. Splash 也可以直接安装在远程服务器上。我们在服务器上以守护态运行 Splash 即可，命令如下：
```
docker run -d -p 8050:8050 scrapinghub/splash
```
5. 这里多了 -d 参数，它代表将 Docker 容器以守护态运行，这样在中断远程服务器连接后，不会终止 Splash 服务的运行。

##### Scrapy-Splash 安装
1. 成功安装 Splash 之后，接下来再来安装其 Python 库，命令如下：
```
pip3 install scrapy-splash
```

#### Scrapy-Redis 安装
1. Scrapy-Redis 是 Scrapy 的分布式扩展模块，有了它，我们就可以方便地实现 Scrapy 分布式爬虫的搭建。本节中，我们将介绍 Scrapy-Redis 的安装方式。
2. 相关链接
```
(1) GitHub: https://github.com/rmax/scrapy-redis
(2) PyPI: https://pypi.python.org/pypi/scrapy-redis
(3) 官方文档：http://scrapy-redis.readthedocs.io
```

##### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install scrapy-redis
```

##### wheel 安装
1. 此外，也可以到 PyPI 下载 wheel 文件安装(详见https://pypi.python.orglpypi/scrapy-redis#downloads)，如当前的最新版本为 0.6.8 ，则可以下载 scrapy_redis-0.6.8-py2.py3-none-any.whl ，然后通过 pip 安装即可：
```
pip3 install scrapy_redis-0.6.8-py2.py3-none-any.whl
```

##### 安装完成之后，可以在 Python 命令行下测试：
```
$ python3 
>> import scrapy_redis
```

## 部署相关库安装
1. 如果想要大规模抓取数据，那么一定会用到分布式爬虫。对于分布式爬虫来说，我们需要多台主机，每台主机有多个爬虫任务，但是源代码其实只有一份。此时我们需要做的就是将一份代码同时部署到多台主机上来协同运行，那么怎么去部署就是另一个值得思考的问题。
2. 对于 Scrapy 来说，它有一个扩展组件，叫作 Scrapyd ，我们只需要安装该扩展组件，即可远程管理 Scrapy 任务，包括部署源码、启动任务、监听任务等。另外，还有 Scrapyd-Client 和 Scrapyd API 来帮助我们更方便地完成部署和监听操作。
3. 另外，还有一种部署方式，那就是 Docker 集群部署。我们只需要将爬虫制作为 Docker 镜像，只要主机安装了 Docker ，就可以直接运行爬虫，而无需再去担心环境配置、版本问题。

### Docker 安装
1. Docker 是一种容器技术，可以将应用和环境等进行打包，形成一个独立的、类似于 ios 的 App 形式的“应用”。
2. 这个应用可以直接被分发到任意一个支持 Docker 的环境中，通过简单的命令即可启动运行。
3. Docker 是一种最流行的容器化实现方案，和虚拟化技术类似，它极大地方便了应用服务的部署；又与虚拟化技术不同，它以一种更轻量的方式实现了应用服务的打包。
4. 使用 Docker ，可以让每个应用彼此相互隔离，在同一台机器上同时运行多个应用，不过它们彼此之间共享同一个操作系统。
5. Docker 的优势在于，它可以在更细的粒度上进行资源管理，也比虚拟化技术更加节约资源。
6. 对于爬虫来说，如果我们需要大规模部署爬虫系统的话，用 Docker 会大大提高效率。工欲善其事，必先利其器。本节中，我们就来介绍三大平台下 Docker 的安装方式。
7. 相关链接
```
(1) 官方网站: https://www.docker.com
(2) GitHub: https://github.com/docker
(3) Docker Hub: https://hub.docker.com
(4) 官方文档: https://docs.docker.com
(5) DaoCloud: http://www.daocloud.io
(6) 中文社区: http://www.docker.org.cn
(7) 中文教程: http://www.runoob.com/docker/docker-tutorial.html
(8) 推荐图书: https://yeasy.gitbooks.io/docker_practice
```

#### Windows 下安装
1. 如果你的是 64位 Windows 10 系统，那么推荐使用 Docker for Windows 。
2. 此时直接从 Docker 官方网站下载最新的 Docker for Windows [安装包](!https://docs.docker.com/docker-for-windows/install/)即可。
3. 如果不是 64 位 Windows 10 系统，则可以下载 [Docker Toolbox](!https://docs.docker.com/toolbox/toolbox_install_windows/)。
4. 下载后直接双击安装即可，详细过程可以参考文档说明。安装完成后，进入命令行。运行 docker 命令测试：
```
docker
```

#### Linux 下安装
1. 详细的步骤安装说明可以参见[官方文档](!https://docs.docker.com/engine/installation/linux/ubuntu/)。
2. 官方文档中详细说明了不同 Linux 系统的安装方法，根据文档一步步执行即可安装成功。但是为了使安装更加方便，Docker 官方还提供了一键安装脚本。
3. 使用它，会使安装更加便捷，不用再去一步步执行命令安装了。首先是 Docker 官方提供的安装脚本。相比其他脚本，官方提供的一定更靠谱，安装命令如下：
```
curl -sSL https://get.docker.com/ | sh
```
4. 只要执行如上一条命令，等待一会儿 Docker 便会安装完成，这非常方便。
5. 但是使用官方脚本安装有一个缺点，那就是慢，也可能下载超时，所以为了加快下载速度，我们可以使用国内的镜像来安装，所以这里还有阿里云和 DaoCloud 的安装脚本。
6. 阿里云的安装脚本：
```
curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh
```
7. DaoCloud 的安装脚本：
```
curl -sSL https://get.daocloud.io/docker | sh
```
8. 等待脚本执行完毕之后，就可以使用 Docker 相关命令了，如运行测试 Hello World 镜像：
```
docker run hello-world
```

#### Mac 下安装
1. Mac 平台同样有两种选择: Docker for Mac 和 Docker Toolbox。Docker for Mac 要求系统为 OS X EI Captain 10.11 或更加新，至少 4GB 内存。如果你的系统满足此要求，则强烈建议安装 Docker for Mac 。
2. 这里可以使用 Homebrew 安装，安装命令如下：
```
brew cask install docker
```
3. 另外，也可以手动下载[安装包](!https://download.docker.corn/mac/stable/Docker.dmg)安装。
4. 下载完成后，直接双击安装包，然后将程序拖动到应用程序中即可。点击程序图标运行 Docker ，会发现在菜单栏中出现了 Docker 的图标，点击小鲸鱼图标，展开菜单之后，再点击 Start 按钮即可启动 Docker 。
5. 启动成功后，便会提示 Docker is running ，随后，我们就可以在命令行下使用 Docker 命令了。可以使用如下命令测试运行：
```
sudo docker run hello-world
```
6. 如果系统不满足要求，可以下载 Docker Toolbox ，其安装说明为：https://docs.docker.com/toolbox/overview/ 。

#### 镜像加速
1. 安装好 Docker 之后，在运行测试命令时，我们会发现它首先会下载一个 Hello World 的镜像，然后将其运行。但是这里的下载速度有时候会非常慢，这是因为它默认还是从国外的 Docker Hub 下载的。
2. 因此，为了提高镜像的下载速度，我们还可以使用国内镜像来加速下载，于是就有了 Docker 加速器一说。
3. 推荐的 Docker 加速器有 DaoCloud (详见：https://www.daocloud.io/mirror)和阿里云(详见：https://cr.console.aliyun.com/#/accelerator)。
4. 不同平台的镜像加速方法配置可以参考 DaoCloud 的[官方文档](!http://guide.daocloud.io/dcs/daocloud-9153151.html)

### Scrapyd 安装
1. Scrapyd 是一个用于部署和运行 Scrapy 项目的工具，有了它，你可以将写好的 Scrapy 项目上传到云主机并通过 API 来控制它的运行。
2. 既然是 Scrapy 项目部署，基本上都使用 Linux 主机，所以本节的安装是针对于 Linux 主机的。
3. 相关链接
```
(1) GitHub: https://github.com/scrapy/scrapyd
(2) PyPI: https://pypi.python.org/pypi/scrapyd
(3) 官方文档: https://scrapyd.readthedocs.io
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install scrapyd
```

#### 配置
1. 安装完毕之后，需要新建一个配置文 /etc/scrapyd/scrapyd.conf , Scrapyd 在运行的时候会读取此配置文件。
2. 在 Scrapyd1.2 版本之后，不会自动创建该文件，需要我们自行添加。
3. 首先，执行如下命令新建文件：
```
sudo mkdir /etc/scrapyd 
sudo vi /etc/scrapyd/scrapyd.conf
```
4. 配置文件的内容可以参见[官方文档](!https://scrapyd.readthedocs.io/en/stable/config.html#example-configuration-file)。

#### 后台运行
1. Scrapyd 是一个纯 Python 项目，这里可以直接调用它来运行。
2. Linux 和 Mac 可以使用如下命令：
```
(scrapyd > /dev/null &)
```
3. 这样 Scrapyd 就会在后台持续运行了，控制台输出直接忽略。当然，如果想记录输出日志，可以修改输出目标，如：
```
(scrapyd >~/scrapyd.log &)
```
4. 此时会将 Scrapyd 的运行结果输出到 ～/scrapyd.log 文件中。当然也可以使用 screen、tmux、supervisor 等工具来实现进程守护。

#### 访问认证
1. 配置完成后，Scrapyd 和它的接口都是可以公开访问的。如果想配置访问认证的话，可以借助于 Nginx 做反向代理，这里需要先安装 Nginx 服器。
2. 在此以 Ubuntu 为例进行说明，安装命令如下：
```
sudo apt-get install nginx
```
3. 然后修改 Nginx 的配置文件 nginx.conf ，增加如下配置：
```
http { 
  server 
    { listen 6801; 
    location / { 
      proxy_pass http://127.0.0.1:6800/; 
      auth basic "Restricted"; 
      auth_basic_user_file /etc/nginx/conf.d/.htpasswd;
      }
    }
  }
```
4. 这里使用的用户名和密码配置放置在 /etc/nginx/conf.d 目录下，我们需要使用 htpasswd 命令创建。例如，创建一个用户名为 admin 的文件，命令如下：
```
htpasswd -c .htpasswd admin
```
5. 接着就会提示我们输入密码，输入两次之后，就会生成密码文件。此时查看这个文件的内容：
```
cat .htpasswd 
admin:SZBxQrorCqwbc
```
6. 配置完成后，重启一下 Nginx 服务，运行如下命令：
```
sudo nginx -s reload
```
7. 这样就成功配置了 Scrapyd 的访问认证了。

### Scrapyd-Client 安装
1. 在将 Scrapy 代码部署到远程 Scrapyd 的时候，第一步就是要将代码打包为 EGG 文件，其次需要将 EGG 文件上传到远程主机。
2. 这个过程如果用程序来实现，也是完全可以的，但是我们并不需要做这些工作，因为 Scrapyd-Client 已经为我们实现了这些功能。下面我们就来看看 Scrapyd-Client 的安装过程。
3. 相关链接
```
(1) GitHub: https://github.com/scrapy/scrapyd-client
(2) PyPI: https://pypi.python.org/pypi/scrapyd-client
(3) 使用说明: https://github.corn/scrapy/scrapyd-client#scrapyd-deploy
```

#### pip 安装
1. 这里推荐使用 pip 安装，相关命令如下：
```
pip3 install scrapyd-client
```

#### 验证安装
1. 安装成功后会有一个可用命令，叫作 scrapyd-deploy ，即部署命令。我们可以输入如下测试命令测试 Scrapyd-Client 是否安装成功：
```
scrapyd-deploy -h
```

#### Scrapyd API 安装
1. 安装好了 Scrapyd 之后，我们可以直接请求它提供的 API 来获取当前主机的 Scrapy 任务运行状况。
2. 比如，某台主机的IP为 192.168.1.1 ，则可以直接运行如下命令获取当前主机的所有 Scrapy 项目：
```
curl http://localhost:6800/listprojects.json
```
3. 运行结果如下：
```
{"status"："ok", "projects": ["myproject","otherproject"]}
```
4. 返回结果是 JSON 字符串，通过解析这个字符串，便可以得到当前主机的所有项目。
5. 但是用这种方式来获取任务状态还是有点烦琐，所以 Scrapyd API 就为它做了一层封装，下面我们来看下它的安装方式。
6. 相关链接
```
(1) GitHub: https://pypi.python.org/pypi/python-scrapyd-api/
(2) PyPI: https://pypi.python.org/pypi/python-scrapyd-api
(3) 官方文档: https://python.srapyd-api.readthedocs.io/en/latest/usage.html
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip install python-scrapyd-api
```

#### 验证安装
1. 安装完成之后，便可以使用 Python 来获取主机状态了，所以上面的操作便可以用 Python 代码实现：
```
from scrapyd api import ScrapydAPI 
scrapyd = ScrapydAPI ('http://localhost:6800') print(scrapyd.list_projects())
```
2. 运行结果如下：
```
["myproject otherproject"]
```

### Scrapyrt 安装
1. Scrapyrt 为 Scrapy 提供了一个调度的 HTTP 接口，有了它，我们就不需要再执行 Scrapy 命令而是通过请求一个 HTTP 接口来调度 Scrapy 任务了。
2. Scrapyrt 比 Scrapyd 更轻量，如果不需要分布式多任务的话，可以简单使用 Scrapyrt 实现远程 Scrapy 任务的调度。
3. 相关链接
```
(1) GitHub: https://github.com/scrapinghub/scrapyrt
(2) 官方文档: http://scrapyrt.readthedocs.io
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install scrapyrt
```
2. 接下来，在任意一个 Scrapy 项目中运行如下命令来启动 HTTP 服务：
```
scrapyrt
```
3. 如果想更换运行端口，可以使用 -p 参数，如：
```
scrapyrt -p 9081
```

### Docker 安装
1. 另外，Scrapyrt 也支持 Docker 。比如，要想在 9080 端口上运行，且本地 Scrapy 项目的路径为 /home/quotesbot ，可以使用如下命令运行：
```
docker run -p 9080:9080 -tid -v /home/user/quotesbot:/scrapyrt/project scrapinghub/scrapyrt
```
2. 这样同样可以在 9080 端口上监听指定的 Scrapy 项目。

#### Gerapy 安装
1. Gerapy 是一个 Scrapy 分布式管理模块，本节就来介绍一下它的安装方式。
2. 相关链接
```
(1) GitHub: https://github.com/Gerapy
```

#### pip 安装
1. 这里推荐使用 pip 安装，命令如下：
```
pip3 install gerapy
```

#### 测试安装
1. 安装完成后，可以在 Python 命令行下测试：
```
$ python3
>>import gerapy
```
2. 如果没有错误报出，则证明库已经安装好了。
